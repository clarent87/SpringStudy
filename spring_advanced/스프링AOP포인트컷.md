# μ¤ν”„λ§ AOP ν¬μΈνΈ μ»·

## ν¬μΈνΈμ»· μ§€μ‹μ

- κ°μ”
  - ν¬μΈνΈμ»· μ§€μ‹μ μ†κ°

- ν¬μΈνΈμ»· μ§€μ‹μ
  - ν¬μΈνΈμ»· ν‘ν„μ‹μ€ execution κ°™μ€ ν¬μΈνΈμ»· μ§€μ‹μ(Pointcut Designator)λ΅ μ‹μ‘ν•λ‹¤.
  - μ¤„μ—¬μ„ PCDλΌ ν•λ‹¤
  - μ—¬λ¬ μΆ…λ¥κ°€ μ΅΄μ¬
  - > μ•μ„  μμ λ“¤μ `@Pointcut("execution(* hello.aop.order..*(..))")` μ—μ„ executionμ΄ PCDμ„

- ν•µμ‹¬
  - execution μ€ κ°€μ¥ λ§μ΄ μ‚¬μ©ν•κ³ , λ‚λ¨Έμ§€λ” μμ£Ό μ‚¬μ©ν•μ§€ μ•λ”λ‹¤.
  - λ”°λΌμ„ execution μ„ μ¤‘μ μ μΌλ΅ μ΄ν•΄ν•μ.

> λ’¤μ—μ„ λ‚μ¬ λ‚΄μ©λ“¤μ€ κ²°κµ­ PCDμ— λ€ν• λ‚΄μ©μ„

## μμ  λ§λ“¤κΈ° (2)

- κ°μ”
  - μΌλ‹¨ λ‹¤μ κ°•μλ“¤μ„ μ„ν• μμ‹ λ§λ“¬

- ν¬μΈνΈ
  - `MemberServiceImpl.class.getMethod("hello", String.class);`
    - > νΉμ • classμ—μ„ method μ •λ³΄λ¥Ό reflectionμΌλ΅ λ½‘μ

- ν¬μΈνΈ2 π‘

    ```java
        @Test
        void printMethod() {
            // [*] κ·Έλƒ¥ method μ •λ³΄ μ°μΌλ©΄ μ•„λμ™€ κ°™μ΄ λ‚μ΄
            // [*] execution PCDμ— μ£Όμ—λ aspectj λ¬Έλ²•μ΄ μ•„λμ™€ λ§¤μΉ­λλ” κ±°λΌμ„ μ°μ–΄λ΄„
            // public java.lang.String hello.aop.member.MemberServiceImpl.hello(java.lang.String)
            log.info("helloMethod={}", helloMethod);
        }
    ```

## execution - 1 (5)

- κ°μ”
  - executionμ†κ°
  - exactMatch(),allMatch() λ“± μ½”λ“ μ‘μ„±ν•¨

- `execution(modifiers-pattern? ret-type-pattern declaring-type-pattern?name-pattern(param-pattern) throws-pattern?)`
  - μ΄κ±°λ” λ‹¤μκ³Ό κ°™μ
  - `execution(μ ‘κ·Όμ μ–΄μ? λ°ν™νƒ€μ… μ„ μ–Ένƒ€μ…?λ©”μ„λ“μ΄λ¦„(νλΌλ―Έν„°) μμ™Έ?)`
  - ?λ¶™μ€ λ¶€λ¶„μ€ μƒλµν•  μ μλ‹¤.
  - ν¨ν„΄μκ²½μ° `*` κ°™μ€ ν¨ν„΄μ„ μ§€μ •ν•  μ μλ‹¤

- λ§¤μΉ­ μ΅°κ±΄
  - `"execution(public String  hello.aop.member.MemberServiceImpl.hello(String)) "` λ¥Ό ν’€μ–΄μ„ λ³΄λ©΄ λ‹¤μκ³Ό κ°™μ
  - μ ‘κ·Όμ μ–΄μ?: public
  - λ°ν™νƒ€μ…: String
    - > ? κ°€ μ•λ¶™μ—μΌλ‹ ν•„μ
  - μ„ μ–Ένƒ€μ…?: hello.aop.member.MemberServiceImpl
    - > package κ²½λ΅ λ‹¤λ“¤μ–΄ μ™€μ•Όν•¨
    - > νƒ€μ…μ΄λΌλ”κ²ƒμ€ classλ¥Ό λ§ν•¨
  - λ©”μ„λ“μ΄λ¦„: hello
    - > ? κ°€ μ•λ¶™μ—μΌλ‹ ν•„μ
  - νλΌλ―Έν„°: (String)
    - > ? κ°€ μ•λ¶™μ—μΌλ‹ ν•„μ
  - μμ™Έ?: μƒλµ

- κ°€μ¥λ§μ΄ μƒλµν• μ½”λ“ π‘
  - `"execution(* *(..))"`
  - μ„ μ½”λ“λ” ν’€μ–΄μ“°λ©΄ λ‹¤μκ³Ό κ°™μ
    - μ ‘κ·Όμ μ–΄μ?: μƒλµ
    - λ°ν™νƒ€μ…: *
    - μ„ μ–Ένƒ€μ…?: μƒλµ
    - λ©”μ„λ“μ΄λ¦„: *
    - νλΌλ―Έν„°: (..)
    - μμ™Έ?: μ—†μ

- λ©”μ„λ“ μ΄λ¦„ λ§¤μΉ­ μμ‹

  ```java
    @Test
    void nameMatchStar2() {
        //λ©”μ„λ“ μ΄λ¦„ μ• λ’¤μ— * μ„ μ‚¬μ©ν•΄μ„ λ§¤μΉ­ν•  μ μλ‹¤.
        pointcut.setExpression("execution(* *el*(..))");
        assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();
    }
  ```

- `hello.aop.member.*(1).*(2)`
  - μ—¬κΈ°μ„ 1λ²μ€ νƒ€μ…/class λ¥Ό λ§ν•κ³  2λ²μ€ method λ…μ„
  - > codeλ‘ κ°™μ΄ λ³΄λ©΄μ΄ν•΄λ¨
  - > codeλ” ExecutionTest

- ν¬μΈνΈμ»· execution λ¬Έλ²•μ—μ„ ν¨ν‚¤μ§€κ²½λ΅λ” λ‚νƒ€λ‚΄λ” `. , ..` μ μ°¨μ΄λ¥Ό μ΄ν•΄ν•΄μ•Ό ν•λ‹¤
  - `.` : μ •ν™•ν•κ² ν•΄λ‹Ή μ„μΉμ ν¨ν‚¤μ§€
  - `..` : ν•΄λ‹Ή μ„μΉμ ν¨ν‚¤μ§€μ™€ κ·Έ ν•μ„ ν¨ν‚¤μ§€λ„ ν¬ν•¨

μ—¬κΈ°λ” μ½”λ“ μ°Έμ΅°ν•λ”κ² μΆ‹μ. μ£Όμ„ λ‹¬μ•„λ‘ 

## execution - 2 (9)

- κ°μ”
  - typeλ§¤μΉ­ μ†κ°
  - νλΌλ©”ν„° λ§¤μΉ­ μ†κ°

- κ°„λ‹¨ μμ‹  (μ΄κ±΄ λ‹Ήμ—°ν• μμ‹)

  ```java
      // typeμ€ classλ¥Ό λ§ν•λ”κ±°. λ³΄λ©΄ μ •ν™•ν•κ² λ§¤μΉ­λλ‹¤. 
      // MemberServiceImpl.* μ—μ„ .λ’¤μ *λ” methodλ…μ— λ§¤μΉ­λ¨
      @Test
      void typeExactMatch() {
          pointcut.setExpression("execution(* hello.aop.member.MemberServiceImpl.*(..))");
          assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();
      }
  ```

- μ•„λ μμ‹κ°€ μ¤‘μ”

  ```java
    pointcut.setExpression("execution(* hello.aop.member.MemberService.*(..))");
    // helloMethod λ” MemberService interfaceμ— μμ. κ·Έλμ„ λ§¤μΉ­μ΄ λ¨ (λ¶€λ¨ νƒ€μ…μ— λ§¤μΉ­ κ°€λ¥)
    // λ‹Ήμ—°ν• λ§μ΄κΈ΄ ν•λ°, λ§μ•½ helloMethodκ°€ MemberServiceμ— μ—†μ—λ‹¤λ©΄ falseμ„
    assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();

  ```

- νλΌλ©”ν„° λ§¤μΉ­
  - μ•μ„ μ‚¬μ©ν–λ νλΌλ©”ν„°μ `(..)`λ” λ¨λ“  νλΌλ©”ν„°μ— λ§¤μΉ­λλ‹¤λ”κ²ƒ
    - > μ¦‰, μ΄κ±°λ” νλΌλ©”ν„°κ°€ μ—†λ” μΌ€μ΄μ¤λ„ ν¬ν•¨λλ‹¤.
  - `()`λ” νλΌλ©”ν„°κ°€ μ—†λ‹¤λ” μλ―Έ --> μ½”λ“μ—μ„ μ‚¬μ©λ λ¨μµμ„ μ°Έμ΅°ν•κΈ° λ°”λ
  - `"execution(* *(String, ..))"`
    - μ”κ±° μ΄ν•΄ν•λ©΄ λ --> μ½”λ“λ‚ pdf μ°Έμ΅° ν•κΈ° λ°”λ

- execution νλΌλ―Έν„° λ§¤μΉ­ κ·μΉ™μ€ λ‹¤μκ³Ό κ°™λ‹¤.
  - (String) : μ •ν™•ν•κ² String νƒ€μ… νλΌλ―Έν„°
  - () : νλΌλ―Έν„°κ°€ μ—†μ–΄μ•Ό ν•λ‹¤.
  - (*) : μ •ν™•ν ν•λ‚μ νλΌλ―Έν„°, λ‹¨ λ¨λ“  νƒ€μ…μ„ ν—μ©ν•λ‹¤.
  - `(*, *)` : μ •ν™•ν λ‘ κ°μ νλΌλ―Έν„°, λ‹¨ λ¨λ“  νƒ€μ…μ„ ν—μ©ν•λ‹¤.
  - (..) : μ«μμ™€ λ¬΄κ΄€ν•κ² λ¨λ“  νλΌλ―Έν„°, λ¨λ“  νƒ€μ…μ„ ν—μ©ν•λ‹¤.
    μ°Έκ³ λ΅ νλΌλ―Έν„°κ°€ μ—†μ–΄λ„ λλ‹¤. 0..* λ΅μ΄ν•΄ν•λ©΄ λλ‹¤.
  - (String, ..) : String νƒ€μ…μΌλ΅ μ‹μ‘ν•΄μ•Ό ν•λ‹¤. μ«μμ™€ λ¬΄κ΄€ν•κ² λ¨λ“  νλΌλ―Έν„°, λ¨λ“  νƒ€μ…μ„ ν—μ©ν•λ‹¤.
    μ) (String) , (String, Xxx) , (String, Xxx, Xxx) ν—μ©

## within (12)

- κ°μ”
  - within PCD μ†κ°
  
- within
  - ν•΄λ‹Ή νƒ€μ…(class)μ΄ λ§¤μΉ­λλ©΄ **κ·Έ μ•μ λ©”μ„λ“(μ΅°μΈ ν¬μΈνΈ)λ“¤**μ΄ μλ™μΌλ΅ λ§¤μΉ­λλ‹¤.
  - λ¬Έλ²•μ€ λ‹¨μν•λ° execution μ—μ„ νƒ€μ… λ¶€λ¶„λ§ μ‚¬μ©ν•λ‹¤κ³  λ³΄λ©΄ λ
  - > μμ‚¬μ© μ•ν•λ” PCDμ„

- μ£Όμμ ! π‘
  - within μ‚¬μ©μ‹ μ£Όμν•΄μ•Ό ν•  μ μ΄ μλ‹¤. ν‘ν„μ‹μ— λ¶€λ¨ νƒ€μ…μ„ μ§€μ •ν•λ©΄ μ•λλ‹¤λ” μ μ΄λ‹¤.
  - μ •ν™•ν•κ² νƒ€μ…μ΄ λ§μ•„μ•Ό ν•λ‹¤. μ΄ λ¶€λ¶„μ—μ„ execution κ³Ό μ°¨μ΄κ°€ λ‚λ‹¤.

λ¬Έλ²• μμ²΄λ” μ‰½λ„¤, λ§ν•λ€λ΅ execution λ¬Έλ²•μ νƒ€μ… λ¶€λ¶„λ§ μ‚¬μ©ν•¨
  
μ—¬νΌ μ΄κ±°λ” μμ‚¬μ©μ•ν•¨. μ΄κ±° λ€μ‹  executionμ„ μ“°κ²λ¨. λ³„μ΄μ  λ•λ¬Έμ— κ·Έλ°κ±΄ μ•„λ‹κ³   
withinμ— μ μ©ν• μ μλ” λ¬Έλ²•μ΄ typeμ—λ§ ν•μ •λμ–΄μ„.. κ·Έλ¦¬κ³  μΈν„°νμ΄μ¤λ¥Ό λ€μƒμΌλ΅ ν¬μΈνΈμ»·μ„ κ±ΈκΈ°λ„ ν•λ”λ°
executionμΌλ΅λ” λλ„, withinμΌλ΅λ” μ•λ¨..

## args (14)

- κ°μ”
  - args μ†κ°
  - ArgsTest μ‘μ„±ν•¨
  - > κ·Όλ° withinμ²λΌ λ”±ν μ¤‘μ”ν• κ²ƒμ€ μ•„λ‹κ°€λ΄„

- args
  - withinμ€ execution μ νƒ€μ… λ¶€λ¶„λ§μΌλ΅ λ§¤μΉ­ν•λ”κ±°λΌλ©΄
  - argsλ” executionμ param λ¶€λ¶„λ§μΌλ΅ λ§¤μΉ­ν•λ”κ²ƒ
    - > κ·Όλ° executionμ param λ§¤μΉ­μ΄λ‘μ€ μ°¨μ΄κ°€ μλ‹¤. μ•½κ°„
  
- κΈ°λ³Έ λ¬Έλ²•μ€ execution μ args λ¶€λ¶„κ³Ό κ°™λ‹¤
- executionκ³Ό argsμ μ°¨μ΄μ 
  - execution μ€ νλΌλ―Έν„° νƒ€μ…μ΄ μ •ν™•ν•κ² λ§¤μΉ­λμ–΄μ•Ό ν•λ‹¤.
  - execution μ€ ν΄λμ¤μ— μ„ μ–Έλ μ •λ³΄λ¥Ό κΈ°λ°μΌλ΅ νλ‹¨ν•λ‹¤.
  - args λ” λ¶€λ¨ νƒ€μ…μ„ ν—μ©ν•λ‹¤. args λ” **μ‹¤μ  λ„μ–΄μ¨ νλΌλ―Έν„° κ°μ²΄ μΈμ¤ν„΄μ¤**λ¥Ό λ³΄κ³  νλ‹¨ν•λ‹¤
  - > executionμ κ²½μ° λ¬Έλ²•μ—μ„ νƒ€μ…(class) λ¶€λ¶„μ€ λ¶€λ¨ classλ΅ λ°›λ”κ² κ°€λ¥ν–μ
  - > κ·Όλ° paramμ κ²½μ° Methodμ— μ„ μ–Έλ param typeμ΄λ‘ λ¬Έλ²•μΌλ΅ λ…μ‹ν• typeμ΄ μ •ν™•ν μΌμΉν•΄μ•Όν–μ
  - > argsλ” ν΄λμ¤μ— μ„ μ–Έλ μ •λ³΄λ¥Ό κΈ°λ°μΌλ΅ λ§¤μΉ­ν•λ”κ² μ•„λ‹λΌ, μ‹¤μ  λ„μ–΄μ¨ κ°μ²΄λ¥Ό λ³΄κ³  νλ‹¨ν•λ‹κΉ, λ¶€λ¨ νƒ€μ… λ§¤μΉ­ κ°€λ¥

- `args(java.io.Serializable): λ°νƒ€μ„μ— μ „λ‹¬λ μΈμλ΅ νλ‹¨ (λ™μ )`
  - μ΄ λ§μ€ μ‹¤μ  κ°μ²΄κ°€ λ„μ–΄μ™€μ•Ό ν¬μΈνΈμ»· true, false νλ‹¨ λλ‹¤λ”κ²ƒ
  - > λ¬Όλ΅  argsμ κ²½μ° testλ” method handleλ΅ κ°€λ¥ν–μ§€λ§.

- μ°Έκ³ 
  - args μ§€μ‹μλ” λ‹¨λ…μΌλ΅ μ‚¬μ©λκΈ° λ³΄λ‹¤λ” λ’¤μ—μ„ μ„¤λ…ν•  νλΌλ―Έν„° λ°”μΈλ”©μ—μ„ μ£Όλ΅ μ‚¬μ©λλ‹¤.

## @target, @within (17)

- μ•μ„  λ‚΄μ© λ¦¬λ§μΈλ“
  - @Around λ” μ–΄λ“λ°”μ΄μ¤ μΈλ°, μ΄κ±° μΆ…λ¥κ°€ 6κ°μ―¤ λμ—μ
  - @Around μ— PCD λ„£μ„μ μλ”λ°, μ΄κ² μ‹«μΌλ©΄ @PointcutμΌλ΅ λ”°λ΅ ν¬μΈνΈμ»·μ„ λΉΌμ„ λ§λ“¤μ μμ
    - AspectJExpressionPointcut classλ΅ ν¬μΈνΈμ»· κ°μ²΄ λ§λ“λ”κ²ƒμ€, advisorλ¥Ό μ§μ ‘ λ§λ“¤λ–„ pointcut, adviceλ¥Ό λ„£μ–΄μ£Όλ”λ° μ»μ—‡κ³ 
      - μ΄κ²½μ° ProxyFactoryλ¥Ό μ΄μ©ν–μ—‡μ§€..
    - test codeλ΅ κ°•μν•κΈ° μ„ν•΄μ„λ„ μ»μ
  - μ–΄λ“λ°”μ΄μ¤λ” μ μ© μμ„κ°€ κΈ°λ³Έμ μΌλ΅ μ—†μ
    - @Orderλ΅ μμ„ μ μ©ν• μλ” μλ”λ°, μ΄κ²½μ° classλ‹¨μ„λ΅λ§ κ°€λ¥
  - @Aspectλ” κΈ°λ³Έμ μΌλ΅ beanλ“±λ΅μ΄ μ•λ¨. λ”°λΌμ„ μ§μ ‘ λ“±λ΅μ„ ν•΄μ£Όμ–΄μ•Όν•λ‹¤.
    - > μ›λ¦¬λ” bean ν›„μ²λ¦¬κΈ° μ™€ κ°™λ‹¤κ³  ν•μ€κ³ , proxy projectμ—μ„ λΉ ν›„μ²λ¦¬κΈ°λ¥Ό ν†µν• μ›λ¦¬λ¥Ό λ³΄μ„
    - > κ·Όλ° μ΄κ±° μ‹¤μ  μ‘λ™ λ°©μ‹μ€ AspectAop μ°Έμ΅°
  - **classλ¥Ό typeμ΄λΌκ³ λ„ ν•¨** κ·Έλμ„ μ–΄λ…Έν…μ΄μ… λ§λ“¤λ• `@Target(ElementType.TYPE)` λ¥Ό λ¶™μ΄λ©΄ classλ¥Ό targetμΌλ΅ ν•λ‹¤λ”μλ―Έ
    - > @target κ³Ό @Target μ€ λ‹¤λ¦„. μ•μ—κ»€ PCDλ„ λ’¤μ—κ»€ μ–΄λ…Έν…μ΄μ…

- κ°μ”
  - μ•μ„  withinμ€ κ³Ό ν„μ¬ λ°°μΈ @within λ¨λ‘ PCD λ¬Έλ²•κ·Όλ° μ« λ‹¤λ¦„
    - @withinμ€ μ†λ¬Έμλ΅ μ‹μ‘ν•λ”κ±° μ£Όμ
  - @target, @within λ¨λ‘ PCBμ²λΌ μ‚¬μ©λλ” λ¬Έλ²•μ„ ( μ–΄λ…Έν…μ΄μ… μ•„λ‹)
  - @target , @within μ€ νƒ€μ…μ— μλ” μ• λ…Έν…μ΄μ…μΌλ΅ AOP μ μ© μ—¬λ¶€λ¥Ό νλ‹¨ν•λ‹¤.
  - > μ΄κ²ƒλ„ μƒκ°λ³΄λ‹¤ λ§μ΄ μ‚¬μ©λμ§€λ” μ•λ”κ°€λ΄„

- ν¬μΈνΈ
  - @target, @within
  - μμ‹
    - `@Around("@within(hello.aop.member.annotation.ClassAop) ")`
    - @ClassAop μ–΄λ…Έν…μ΄μ…μ΄ κ±Έλ¦° class μ•μ λ¨λ“  λ©”μ†λ“κ°€ μ΅°μΈν¬μΈνΈ λ€μƒμ΄ λ¨
      - > μ¦‰, ν¬μΈνΈμ»·μ— μν•΄ κ±Έλ¦°λ‹¤λ” κ²ƒ
  - @targetμ κ²½μ° μΈμ¤ν„΄μ¤μ λ¨λ“  λ©”μ†λ“ (λ¶€λ¨ λ©”μ†λ“ ν¬ν•¨)κ°€ μ΅°μΈν¬μΈνΈ λ€μƒμ΄ λλ”κ±°κ³ 
    - > μ¦‰ @ClassAopκ°€ λ¶™μ€ Child classκ°€ μλ‹¤λ©΄, ν•΄λ‹Ή ν΄λμ¤μ λ¶€λ¨ ν΄λμ¤ λ©”μ†λ“ λ¨λ‘ μ΅°μΈν¬μΈνΈκ°€ λ¨ (μ¦‰ μ–΄λ“λ°”μ΄μ¤ λ¶™λ”λ‹¤λ”κ²ƒ)
  - @withinμΈ ClassAopκ°€ λ¶™μ€ classλ§ μ΅°μΈν¬μΈνΈ λ€μƒμ΄ λ¨

- ν¬μΈνΈ2
  - μ•μ„  κ°•μΆμ args, withinμ€ ν¬μΈνΈμ»· κ°μ²΄λ§ λ§λ“¤μ–΄μ„ match methodλ΅ μ‰½κ² testκ°€λ¥ν–λ”λ°
    - > μ΄λ•λ„ method handleμ€ μμ—μ. κ·Όλ° μ΄λ ‡κ² testλ¥Ό ν–λ‹¤κ³  μ •μ μΈ μ •λ³΄λ΅ pointcutμ΄ μ μ©λλ‹¤κ³  μƒκ°ν•λ” κ²ƒμ€ μ¤μ‚° -> args μ²λΌ..
  - @target, @withinμ κ²½μ° μ‹¤μ  κ°μ²΄κ°€ μμ–΄μ•Ό κΈ°λ¥μ„ λ³΄μ—¬ μ¤„μ μμ–΄μ„, targetμ΄ λ  beanκΉμ§€ λ§λ“¤μ–΄μ„ testλ¥Ό ν•μ€λ‹¤.
    - > κ·Έλƒ¥ λ‹¨μν Annotationμ„ classλ€μƒμΌλ΅ κ±Έμ–΄μ•Ό ν•΄μ„ beanμ„ λ§λ“ κ² μ•„λ‹κ°€ μ‹¶λ„¤.
    - @targetμ κ²½μ° μΈμ¤ν„΄μ¤ κΈ°μ¤€ -> μ¦‰ μΈμ¤ν„΄μ¤μ— μλ” λ¨λ“  λ©”μ†λ“κ°€ μ΅°μΈ ν¬μΈνΈ
    - @withinμ κ²½μ° μ •μ μΈ ν΄λμ¤ μ •λ³΄λ§ λ³΄κ³  νλ‹¨ -> μ¦‰ μ–΄λ…Έν…μ΄μ… κ±Έλ¦° classμ λ©”μ†λ“λ§ μ΅°μΈ ν¬μΈνΈ
  - > ν¬κ² μ¤‘μ”ν•μ§€λ” μ•μ

- μ°Έκ³ 
  - @target , @within μ§€μ‹μλ” λ’¤μ—μ„ μ„¤λ…ν•  νλΌλ―Έν„° λ°”μΈλ”©μ—μ„ ν•¨κ» μ‚¬μ©λλ‹¤.

- μ£Όμ
  - λ‹¤μ ν¬μΈνΈμ»· μ§€μ‹μλ” λ‹¨λ…μΌλ΅ μ‚¬μ©ν•λ©΄ μ•λλ‹¤. `args, @args, @target`
  - > pdfλ‚΄μ©λ„ μ« λ¨νΈν•λ°
  - > μ •λ¦¬ν•μλ©΄ μ„ PCDκ°™μ€κ²½μ°, μ„ PCDμ— μν•΄ μ–΄λ“λ°”μ΄μ¤κ°€ μ μ©λμ—λ”μ§€ μ•„λ‹μ§€λ” μ‹¤ν–‰ μ‹μ μ—λ§ μ•μ μμ
    - > argsλ” μ•„λ‹μ§€ μ•λ‚?
  - > λ”°λΌμ„ AnnotationAwareAspectJAutoProxyCreator(μλ™ ν”„λ΅μ‹ μƒμ„±κΈ°) μ—μ„ ν¬μΈνΈ μ»·μΌλ΅ ν”„λ΅μ‹λ¥Ό λ§λ“¤μ§€ λ§μ§€ κ²°μ •ν•΄μ•Όν•λ”λ°,
    - > λΉν›„μ²λ¦¬κΈ°.md λ‚΄μ©
  - > μ„μ— κ²ƒλ“¤μ€ λ¨λ‘ trueλ΅ νλ‹¨ν•΄μ„ μ¤ν”„λ§μ— μ¬λΌμ¤λ” λ¨λ“  beanμ„ ν”„λ΅μ‹λ΅ λ§λ“¤λ ¤κ³  ν•¨. μ΄λ• final μ΄ λ¶™μ€ class beanμ΄ λ€μƒμ΄ λλ©΄
  - > μ¤λ¥κ°€ λ°μƒν•λ‹¤.

μ—¬νΌ, `args, @args, @target` λ” λ°νƒ€μ„μ— λ„μ–΄μ¨ μΈμ/κ°μ²΄κ°€ μμ–΄μ•Ό ν•λ‹¤λ” μ‚¬μ‹¤λ§ κΈ°μ–µν•λ©΄ λ κ±° κ°™λ‹¤.  

- μκ²¬
  - > μ¶”κ°€μ μΌλ΅ @target, @withinμ€ target, within PCDμΈλ° μ•„λ§ annotation λ¶™μ€κ±Έ λ€μƒμΌλ΅ ν•λ‹¤λ” μλ―Έ κ°™λ‹¤. args, @argsλ„ κ°™μ€ κ°λ… κ°™μ

- Q/A π‘
  - @SpringBootTest λ¥Ό μ‚¬μ©ν•λ©΄μ„ κ·Έμ• inner ν΄λμ¤μ—  @Configurationλ¥Ό λ¶™μ—¬μ„ beanμ„ λ“±λ΅ν–λ”λ‹ AOPκ°€ μ μ©λμ§€ μ•λ”λ‹¤..?
    - @Configurationμ„ μ‚¬μ©ν•κ² λλ©΄ μ¤ν”„λ§ λ¶€νΈμ λ‹¤μ–‘ν• μ„¤μ •λ“¤μ΄ λ¨Ήνμ§€ μ•κ³ , @Configuration μ•μ—μ„λ§ μ μ©ν• μ„¤μ •μ΄ λ¨Ήνκ² λ©λ‹λ‹¤.
    - μ΄ μ„¤μ •μ΄ μ°μ„ κ¶μ„ κ°€μ§€κ³  κ°€λ²„λ¦¬κΈ° λ•λ¬Έμ— μ¤ν”„λ§ λ¶€νΈμ λ‹¤λ¥Έ μ„¤μ •μ΄ μ μ©λμ§€ μ•μµλ‹λ‹¤.
    - μ‰½κ² μ΄μ•ΌκΈ°ν•΄μ„ ν…μ¤νΈμ—μ„λ” μ΄ μ„¤μ •λ§ μ‚¬μ©ν•κ² λ©λ‹λ‹¤.
    - μ—¬κΈ°μ„ λ¬Έμ λ” μ¤ν”„λ§ λ¶€νΈκ°€ λ§λ“¤μ–΄μ£Όλ” AOP κ΄€λ ¨ κΈ°λ³Έ ν΄λμ¤λ“¤λ„ μ¤ν”„λ§ λΉμΌλ΅ λ“±λ΅λμ§€ μ•κ³ ,
    - κ²°κµ­ AOP μμ²΄κ°€ λ™μ‘ν•μ§€ μ•κ² λλ‹¤λ” μ μ…λ‹λ‹¤. (κ°•μμ—μ„ λ§μ”€λ“λ¦° AutoProxyκ°€ μμ–΄μ•Ό AOPλ¥Ό μ μ©ν•  μ μμµλ‹λ‹¤.)
    - κ·Έλ¬λ©΄ AOPκ°€ λ™μ‘ν•λ„λ΅ ν•λ” κΈ°λ¥λ“¤μ„ λ“±λ΅ν•λ©΄ λκ² μ§€μ”?
    - λ°”λ΅ @EnableAspectJAutoProxyλ¥Ό λ‹¤μκ³Ό κ°™μ΄ μ§μ ‘ λ„£μ–΄μ£Όμ‹λ©΄ λ©λ‹λ‹¤.
    - κ·Έλ¬λ©΄ AOPκ°€ μ μ©λλ©΄μ„ μ •μƒ λ™μ‘ν•κ² λ©λ‹λ‹¤

    ```java
    @EnableAspectJAutoProxy
    @Configuration
    static class InnerConfig {
    }
        
    ```

    - κ·Έλ°λ° μ΄λ ‡κ² μ‚¬μ©ν•λ” κ²ƒμ€ λ§μ΄ λ²κ±°λ΅­μµλ‹λ‹¤.
    - μ¤ν”„λ§ λ¶€νΈλ” μ¤ν”„λ§ λ¶€νΈμ κΈ°λ³Έ κΈ°λ¥μ„ μ„¤μ •μ„ μ‚¬μ©ν•λ©΄μ„ κ·Έ μ„μ— μ›ν•λ” μ„¤μ •μ„ λ”ν•λ” λ°©λ²•λ„ μ κ³µν•©λ‹λ‹¤.
    - λ°”λ΅ @TestConfigurationμ„ μ‚¬μ©ν•λ©΄ λ©λ‹λ‹¤.

    ```java
    @TestConfiguration
    static class InnerConfig {
    }
    ```

## @annotation, @args (20)

- λ¦¬λ§μΈλ“
  - @Aspect - @Aroundλ΅ proxy μƒμ„±
    - @Aspect λ¶™μΈ classλ” λΉλ“±λ΅μ„ ν•΄μ¤μ•Όν•¨.
      - μλ™ ν”„λ΅μ‹ μƒμ„±κΈ°(λΉν›„μ²λ¦¬κΈ°) κ°€ μ΄κ±°λ‘ Advisor λΉλ“¤ μ„ μ²λ¦¬ν•΄μ¤
    - @Aroundμ—λ” ν¬μΈνΈμ»·λ‚΄μ©(PCD)λ¥Ό μ‘μ„±ν•΄μ£Όκ³ , method bodyμ— advice λ‚΄μ©μ„ μ‘μ„±
    - μ΄λ–„ adviceμ λ°ν™μ€ Object μ΄λ‹¤.
      - @Around μ™Έ λ‚λ¨Έμ§€ 5κ° μ–΄λ“λ°”μ΄μ¤ λ§λ“¤λ• returnμ΄ voidμ„.

- κ°μ”
  - @annotation λ” λ©”μ†λ“μ— κ±Έλ¦° annotationμ„ λ³΄κ³  νλ‹¨ν•λ” PCD
  - μ•μ„  κ°•μΆμ @target, @within λ” ν΄λμ¤μ— κ±Έλ¦° μ–΄λ…Έν…μ΄μ…μ„ λ³΄κ³  νλ‹¨ν•λ” κ±°μ€μ
  - > **μ΄κ±΄ κ°€λ” μ“°μΈλ‹¤κ³  ν•¨**
  - > ν•΄λ³΄λ‹ κ°„λ‹¨ν•¨
  - > @Asyncκ°€ μ΄λ° μ›λ¦¬ μ•„λ‹κΉ?

- @args λ” μμ  μ—†μ΄ μ„¤λ…λ§ μ§„ν–‰
  - `@args(test.Check)`
    - μ „λ‹¬λ μΈμμ λ°νƒ€μ„ νƒ€μ…μ— @Check μ• λ…Έν…μ΄μ…μ΄ μλ” κ²½μ°μ— λ§¤μΉ­ν•λ‹¤.
    - μ¦‰, λ°νƒ€μ„μ‹ `MemberService.hello(ClassA)` λ€ λ©”μ†λ“λ¥Ό νΈμ¶ν•κ²½μ° νλΌλ©”ν„°μΈ ClassAμ— @Checkκ°€ λ¶™μ–΄μμΌλ©΄ λ§¤μΉ­λμ„ νΈμ¶λ¨
  - > μ μ•μ”€

## bean (23)

- κ°μ”
  - **μ¤ν”„λ§ λΉμ μ΄λ¦„**μΌλ΅ AOP μ μ© μ—¬λ¶€λ¥Ό μ§€μ •ν•λ‹¤. μ΄κ²ƒμ€ μ¤ν”„λ§μ—μ„λ§ μ‚¬μ©ν•  μ μλ” νΉλ³„ν• μ§€μ‹μμ΄λ‹¤
  - μ¦‰ aspectj κ°™μ€λ΄ μλ”κ² μ•„λ‹

- ν¬μΈνΈ
  - μ•„λμ™€ κ°™μ΄ μ”€
  - > κ·Όλ° μ—­μ‹ μ μ“°λ”κ±΄ μ•„λ‹λΌκ³  ν•¨
  - `@Around("bean(orderService) || bean(*Repository)")`

## λ§¤κ°λ³€μ μ „λ‹¬ (24)

- κ°μ”
  - μ–΄λ“λ°”μ΄μ¤μ— λ§¤κ°λ³€μ μ „λ‹¬ν•λ” λ°©λ²•
    - > κ·Όλ° method νΈμ¶μ— μ“°λ” paramμ€ ProceedingJoinPoint λ΅ λ°›μ„μ μμ° μ•λ‚? getArgs methodμ§€μ›λλ”λ°..
    - > λ§μ κ°•μμ—μ„λ„ λ‚μ΄
  - > μ¤‘μ”ν•λ‹¤κ³  ν•¨
  - args PCD μ‚¬μ©λ²•μ΄λ‘ λ‹¤μ‹ λΉ„κµν•΄λ³΄λ©΄μ„ λ³΄λ”κ² μΆ‹μ

- μ¤‘μ” ν¬μΈνΈ
  - PCDλ§λ‹¤ μ „λ‹¬ λ°›μ„μ μλ” κ°’μ΄ λ‹¤λ¦„
  - args λ΅λ” μ§„μ§λ΅ paramμ„ μ „λ‹¬ λ°›μ„μ μκ³  ( λ¬Όλ΅  κ·Έλλ„ args PCDλ” μ μ©λ¨)
  - this, targetμΌλ΅λ” ν„μ¬ κ°μ²΄λ¥Ό λ°›μ„μ μμ ( thisλ” ν”„λ΅μ‹ κ°μ²΄ λ°›κ³ , targetμ€ μ‹¤μ  κ°μ²΄ )
  - @annotationμΌλ΅λ” target methodμ— μ μ©λ μ–΄λ…Έν…μ΄μ…μ„ λ°›μ•„μ¬μ μ‡μ
  - @target, @withinμΌλ΅λ” ν„νƒ target classμ— μ μ©λ μ–΄λ…Έν…μ΄μ…μ„ λ°›μ•„μ¬μ μ‡μ

- μ¤‘μ” ν¬μΈνΈ π‘
  - ProceedingJoinPoint λ΅ paramμ„ κΊΌλ‚Όμ μλ”λ° μ΄λ¬λ©΄ **κ°€λ…μ„±μ΄ μΆ‹μ§€κ°€ μ•λ‹¤.**
  - κ·Έλμ„ ν¬μΈνΈμ»· λ§¤κ°λ³€μ μ „λ‹¬μ„ μ΄μ©ν•¨
  - > λ‹¨ λ¨λ“  PCDμ—μ„ paramμ„ κΊΌλ‚Όμ μλ”κ±΄ μ•„λ‹λ“―. 
  - > λ¬Όλ΅  κ·Έλƒ¥ ν¬μΈνΈμ»·μΌλ΅ λ§¤κ°λ³€μλ¥Ό λ°›κ³  μ‹¶λ‹¤λ©΄, PCD && args(arg,..) μ°κ³  typeμ„ Objectλ΅ λ°›μΌλ©΄ λκΈ΄ ν• λ“―. 

  ```java
  @Around("allMember()")
  public Object logArgs1(ProceedingJoinPoint joinPoint) throws Throwable {
      // [*] μ—­μ‹ μƒκ°ν• λ€λ΅ joinPointλ¥Ό μ΄μ©ν•΄μ„ paramκ°’ κ°€μ Έμ¬μ μλ„¤
      // [*] κ·Όλ° μ΄λ ‡κ² λ½‘λ”κ±°λ” κ°€λ…μ„±μ΄ μΆ‹μ§€κ°€ μ•λ‹¤.
      Object arg1 = joinPoint.getArgs()[0];
      log.info("[logArgs1]{}, arg={}", joinPoint.getSignature(), arg1);
      return joinPoint.proceed();
  }
  ```

- ν¬μΈνΈ
  - μ—¬κΈ°μ„ thisμ™€ targetλ„ μμ‹λ΅ μΌλ¶€ λ³΄μ—¬μ¤

- λ¦¬λ§μΈλ“ π¥‰
  - springμ€ proxyFactoryλ¥Ό λ§λ“¤λ• interface κΈ°λ° classκ°€ targetμ΄μ–΄λ„ cglibμ„ μ΄μ©ν•λ‹¤κ³  ν–μ
  - μ—¬κΈ° μμ‹μΈ MemberServiceImpleλ„ interface κΈ°λ°μΈλ°, μ‹¤μ  ν”„λ΅μ‹ λ§λ“¤μ–΄μ§„κ²ƒμ€ μ•„λμ™€ κ°™λ‹¤
    - `class hello.aop.member.MemberServiceImpl$$EnhancerBySpringCGLIB$$99539c87`
    - μ¦‰, MemberServiceImpl λ¥Ό μƒμ†ν•΄μ„ λ§λ“¤μ—λ‹¤κ³  λ΄μ•Ό ν•¨
    - μ‹¤μ λ΅ superclassλ¥Ό μ°μ–΄λ³΄λ‹ MemberServiceImplκ°€ λ‚μ΄
  
μ—¬κΈ°λ” μ¤‘μ”ν• pointλ“¤μ΄ λ§μ ParameterTest classμ— μ£Όμ„ λ§μ΄ λ‹¬μ•„λ‘μ—μΌλ‹ μ°Έμ΅° λ°”λ  

- ν¬μΈνΈ2
  - **μ•„λμ²λΌ μ–΄λ…Έν…μ΄μ… value κΊΌλ‚΄λ”κ±° μΆ…μΆ… μ“Έλ§ν•λ‹¤κ³  ν•¨**

  ```java
   @Before("allMember() && @annotation(annotation)")
        public void atAnnotation(JoinPoint joinPoint, MethodAop annotation) {
            log.info("[@annotation]{}, annotationValue={}", joinPoint.getSignature(), annotation.value());
        }
  ```
  
- μ”μ•½
  - λ³΄λ©΄ PCDμ— λ„£μ—λ type λ€μ‹  λ³€μλ…μ„ μ“°λ”ν•νƒ, μ΄λ• ν•΄λ‹Ή λ³€μμ typeμ€ λ©”μ†λ“λ¥Ό λ³΄κ³  κ²°μ •λ¨ ( κ°™μ€ μ΄λ¦„μ paramμ νƒ€μ…μΌλ΅..)

λ‹¤μ μ μ this, targetμ€ μ μ“°μ§€λ” μ•λ”λ°, λ‚΄μ©μ΄ λ³µμ΅ν•λ‹¤κ³  ν•¨

## this, target (28)

- λ¦¬λ§μΈλ“
  - νƒ€μ…μ΄λ€ ? classλ‚ interfaceλ¥Ό μ§€μΉ­

- κ°μ”
  - this, target μ„¤λ…
  - > μ¤‘μ”ν•κ±΄ μ•„λ‹λ° μ–΄λ ¤μ›€, κ·Όλ° κ³µλ¶€ν•λ‹¤λ³΄λ©΄ λ©”λ‰΄μ–Όμ— μΆ…μΆ… λ‚μ™€μ„ μ†κ°

- μ •μ
  - this : μ¤ν”„λ§ λΉ κ°μ²΄(μ¤ν”„λ§ AOP ν”„λ΅μ‹)λ¥Ό λ€μƒμΌλ΅ ν•λ” μ΅°μΈ ν¬μΈνΈ
  - target : Target κ°μ²΄(μ¤ν”„λ§ AOP ν”„λ΅μ‹κ°€ κ°€λ¥΄ν‚¤λ” μ‹¤μ  λ€μƒ)λ¥Ό λ€μƒμΌλ΅ ν•λ” μ΅°μΈ ν¬μΈνΈ
  - this , target μ€ λ‹¤μκ³Ό κ°™μ΄ μ μ© **νƒ€μ… ν•λ‚λ¥Ό μ •ν™•ν•κ² μ§€μ •**ν•΄μ•Ό ν•λ‹¤.

    ```java
      this(hello.aop.member.MemberService)
      target(hello.aop.member.MemberService)
    ```

  - `*` κ°™μ€ν¨ν„΄μ„μ‚¬μ©ν• μμ—†λ‹¤.
  - λ‘λ‹¤ **λ¶€λ¨ νƒ€μ…μ„ ν—μ©ν•λ‹¤.**
    - > μ΄κ±΄ targetμ λ¶€λ¨ νƒ€μ…μ„ λ…μ‹ν•΄λ„ μ΅°μΈν¬μΈνΈλ΅ κ±Έλ¦°λ‹¤λ”κ²ƒ.
    - > @targetμ΄λ‘ λ§μ°¬κ°€μ§€λ΅ ν•΄λ‹Ή classμ λ¨λ“  λ©”μ†λ“κ°€ μ΅°μΈν¬μΈνΈ λ€μƒμ΄ λ λ“―

- μ¤‘μ” ν¬μΈνΈ
  - μ¤ν”„λ§μ€ JDK λ™μ  ν”„λ΅μ‹μ™€ CGLIBλ¥Ό μ„ νƒ κ°€λ¥ν•λ‹¤
    - > κ·Όλ° κΈ°λ³Έμ μΌλ΅ CGLIBλ§ μ΄μ©ν•λ‹¤λ”κ±° κ°™μ•λ”λ°..
    - κ·Έλμ„ this, targetμ μ μ© μ—¬λ¶€κ°€ κ°κ° λ‹¤λ¥΄λ‹¤.

- μ¤‘μ” ν¬μΈνΈ 2
  - pdf 30 νμ΄μ§€
  - MemberService μΈν„°νμ΄μ¤ μ§€μ • this(hello.aop.member.MemberService) : proxy κ°μ²΄λ¥Ό λ³΄κ³  νλ‹¨ν•λ‹¤.
    - this λ” λ¶€λ¨ νƒ€μ…μ„ν—μ©ν•κΈ° λ•λ¬Έμ— AOPκ°€ μ μ©λλ‹¤.
    - > ν•΄λ‹Ή νμ΄μ§€λ¥Ό λ³΄λ©΄ proxyλ” MemberServiceImpleμ„ μƒμ†λ°›μ•„ κµ¬ν„λμ–΄ μμμ„ μ•μ μ‡λ”° -> cglibμ΄λΌμ„
    - > κ·Όλ° MemberServiceImpleμ€ MemberService interfaceλ¥Ό impleν•λ‹κΉ aopκ°€ μ μ©λλ”κ²ƒ -> μ¦‰, λ¶€λ¨νƒ€μ…μ„ ν—μ©ν•λ‹¤κ³  ν–μΌλ‹...

- μ¤‘μ” ν¬μΈνΈ 3 π‘
  - application.properties μ— μ„Έν…
    - spring.aop.proxy-target-class=true  // CGLIB
    - spring.aop.proxy-target-class=false // JDK λ™μ  ν”„λ΅μ‹
    - > κΈ°λ³Έμ μΌλ΅ μµμ‹  spring-bootλ” CGLIBλ§ λ™μ‘ -> μ™ μ¤ν”„λ§μ΄ μ΄λ° κ²°μ •μ„ ν–λ”μ§€λ” λ’¤ μ½μ—μ„ κ°•μν•λ‹¤κ³  ν•¨
    - > λ‹Ήμ—°ν• λ§μΈλ° falseμΌλ• targetμ΄ κµ¬μ²΄ ν΄λμ¤λ©΄ λ‹Ήμ—°ν CGLIBμ΄ λ™μ‘
  - ν…μ¤νΈμ—μ„  μ•„λμ™€ κ°™μ΄ μ„Έν…
    - `@SpringBootTest(properties = "spring.aop.proxy-target-class=false") //JDK λ™μ  ν”„λ΅μ‹`
    - `//@SpringBootTest(properties = "spring.aop.proxy-target-class=true") //CGLIB`

- μ”μ•½
  - thisλ” ν”„λ΅μ‹ beanμ„ λ€μƒμΌλ΅ μ΅°μΈν¬μΈνΈλ¥Ό κ±ΈκΈ°λ•λ¬Έμ—, ν”„λ΅μ‹ beanμ΄ μ–΄λ–¤ ν•νƒλƒμ— λ”°λΌ κ±Έλ¦¬κ³  μ•κ±Έλ¦¬κ³  ν•¨
    - proxyκ°€ jdk ν”„λ΅μ‹ μ€μ„λ• -> interfaceκΈ°λ°μΌλ΅ ν”„λ΅μ‹ κ°μ²΄κ°€ λ§λ“¤μ–΄ μ§€λ―€λ΅, ν•΄λ‹Ή interfaceλ¥Ό implν• target classλ΅λ” κ±Έλ¦¬μ§€ μ•μ
    - proxyκ°€ cgbli ν”„λ΅μ‹ μΌλ• -> interfaceλ¥Ό implν• target classλ¥Ό μƒμ†ν•΄μ„ ν”„λ΅μ‹ beanμ„ λ§λ“¬. λ”°λΌμ„ interfaceλ¥Ό implν• target classλ΅λ„ κ±Έλ¦Ό
  - targetμ€ μ‹¤μ  target classλ¥Ό λ€μƒμΌλ΅ μ΅°μΈν¬μΈνΈλ¥Ό κ±ΈκΈ° λ•λ¬Έμ—, μ„μ™€ κ°™μ€ μ΄μκ°€ μ—†μ

- μ°Έκ³ 
  - this , target μ§€μ‹μλ” λ‹¨λ…μΌλ΅ μ‚¬μ©λκΈ° λ³΄λ‹¤λ” νλΌλ―Έν„° λ°”μΈλ”©μ—μ„ μ£Όλ΅ μ‚¬μ©λλ‹¤.

- μ •λ¦¬
  - ν”„λ΅μ‹λ¥Ό λ€μƒμΌλ΅ ν•λ” this μ κ²½μ° κµ¬μ²΄ ν΄λμ¤λ¥Ό μ§€μ •ν•λ©΄ ν”„λ΅μ‹ μƒμ„± μ „λµμ— λ”°λΌμ„ λ‹¤λ¥Έ κ²°κ³Όκ°€ λ‚μ¬ μ μλ‹¤λ” μ μ„ μ•μ•„λ‘μ.

- Q/A
  - ν…μ¤νΈ κ²°κ³Όλ¥Ό λ³΄λ©΄ `@Around("this(hello.aop.member.MemberService)")` μ΄κ²½μ° proxyμ νƒ€μ…μ— λ”°λΌμ„ λ™μ‘μ΄ κ²°μ •λλ”λ°
  - κ·Έλ ‡λ‹¤λ©΄ μ„ ν¬μΈνΈμ»·μ κ²½μ° μΌλ‹¨ ν•΄λ‹Ήν•λ” beanμ„ λ¨λ‘ proxy κ°μ²΄λ΅ λ§λ“λ” κ²ƒμΈκ°€?
    - ν¬μΈνΈμ»·μΌλ΅ μΌλ‹¨ ν”„λ΅μ‹λ¥Ό λ§λ“¤μ§€ μ•λ§λ“¤μ§€ κ²°μ •ν•λ”λ° μ‚¬μ©ν•¨.
    - > κ·Όλ° ν•­μƒ tureμΈ ν¬μΈνΈμ»·μ€ λ¨λ“  beanμ— κ±Έλ¦¬κΈ° λ•λ¬Έμ— μ¤λ¥λ‚λ”λ°.. μ„μ™€ κ°™μ€ κ²½μ°λ” MemberService λ‘ λ§¤μΉ­λλ” λ¨λ“  beanμ„ ν”„λ΅μ‹λ΅ λ§λ“λ‚λ΄„
  - > λ‹µλ³€μ€ μ λ¨λ¥΄κ² μ§€λ§ κ·Έλ°κ±° κ°™λ‹¤κ³ ν•¨

## μ •λ¦¬
