# ìŠ¤í”„ë§ AOP í¬ì¸íŠ¸ ì»·

## í¬ì¸íŠ¸ì»· ì§€ì‹œì

- ê°œìš”
  - í¬ì¸íŠ¸ì»· ì§€ì‹œì ì†Œê°œ

- í¬ì¸íŠ¸ì»· ì§€ì‹œì
  - í¬ì¸íŠ¸ì»· í‘œí˜„ì‹ì€ execution ê°™ì€ í¬ì¸íŠ¸ì»· ì§€ì‹œì(Pointcut Designator)ë¡œ ì‹œì‘í•œë‹¤.
  - ì¤„ì—¬ì„œ PCDë¼ í•œë‹¤
  - ì—¬ëŸ¬ ì¢…ë¥˜ê°€ ì¡´ì¬
  - > ì•ì„  ì˜ˆì œë“¤ì˜ `@Pointcut("execution(* hello.aop.order..*(..))")` ì—ì„œ executionì´ PCDì„

- í•µì‹¬
  - execution ì€ ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ê³ , ë‚˜ë¨¸ì§€ëŠ” ìì£¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
  - ë”°ë¼ì„œ execution ì„ ì¤‘ì ì ìœ¼ë¡œ ì´í•´í•˜ì.

> ë’¤ì—ì„œ ë‚˜ì˜¬ ë‚´ìš©ë“¤ì€ ê²°êµ­ PCDì— ëŒ€í•œ ë‚´ìš©ì„

## ì˜ˆì œ ë§Œë“¤ê¸° (2)

- ê°œìš”
  - ì¼ë‹¨ ë‹¤ìŒ ê°•ì˜ë“¤ì„ ìœ„í•œ ì˜ˆì‹œ ë§Œë“¬

- í¬ì¸íŠ¸
  - `MemberServiceImpl.class.getMethod("hello", String.class);`
    - > íŠ¹ì • classì—ì„œ method ì •ë³´ë¥¼ reflectionìœ¼ë¡œ ë½‘ìŒ

- í¬ì¸íŠ¸2 ğŸ‘

    ```java
        @Test
        void printMethod() {
            // [*] ê·¸ëƒ¥ method ì •ë³´ ì°ìœ¼ë©´ ì•„ë˜ì™€ ê°™ì´ ë‚˜ì˜´
            // [*] execution PCDì— ì£¼ì—ˆë˜ aspectj ë¬¸ë²•ì´ ì•„ë˜ì™€ ë§¤ì¹­ë˜ëŠ” ê±°ë¼ì„œ ì°ì–´ë´„
            // public java.lang.String hello.aop.member.MemberServiceImpl.hello(java.lang.String)
            log.info("helloMethod={}", helloMethod);
        }
    ```

## execution - 1 (5)

- ê°œìš”
  - executionì†Œê°œ
  - exactMatch(),allMatch() ë“± ì½”ë“œ ì‘ì„±í•¨

- `execution(modifiers-pattern? ret-type-pattern declaring-type-pattern?name-pattern(param-pattern) throws-pattern?)`
  - ì´ê±°ëŠ” ë‹¤ìŒê³¼ ê°™ìŒ
  - `execution(ì ‘ê·¼ì œì–´ì? ë°˜í™˜íƒ€ì… ì„ ì–¸íƒ€ì…?ë©”ì„œë“œì´ë¦„(íŒŒë¼ë¯¸í„°) ì˜ˆì™¸?)`
  - ?ë¶™ì€ ë¶€ë¶„ì€ ìƒëµí•  ìˆ˜ ìˆë‹¤.
  - íŒ¨í„´ì˜ê²½ìš° `*` ê°™ì€ íŒ¨í„´ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤

- ë§¤ì¹­ ì¡°ê±´
  - `"execution(public String  hello.aop.member.MemberServiceImpl.hello(String)) "` ë¥¼ í’€ì–´ì„œ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŒ
  - ì ‘ê·¼ì œì–´ì?: public
  - ë°˜í™˜íƒ€ì…: String
    - > ? ê°€ ì•ˆë¶™ì—ˆìœ¼ë‹ˆ í•„ìˆ˜
  - ì„ ì–¸íƒ€ì…?: hello.aop.member.MemberServiceImpl
    - > package ê²½ë¡œ ë‹¤ë“¤ì–´ ì™€ì•¼í•¨
    - > íƒ€ì…ì´ë¼ëŠ”ê²ƒì€ classë¥¼ ë§í•¨
  - ë©”ì„œë“œì´ë¦„: hello
    - > ? ê°€ ì•ˆë¶™ì—ˆìœ¼ë‹ˆ í•„ìˆ˜
  - íŒŒë¼ë¯¸í„°: (String)
    - > ? ê°€ ì•ˆë¶™ì—ˆìœ¼ë‹ˆ í•„ìˆ˜
  - ì˜ˆì™¸?: ìƒëµ

- ê°€ì¥ë§ì´ ìƒëµí•œ ì½”ë“œ ğŸ‘
  - `"execution(* *(..))"`
  - ìœ„ ì½”ë“œëŠ” í’€ì–´ì“°ë©´ ë‹¤ìŒê³¼ ê°™ìŒ
    - ì ‘ê·¼ì œì–´ì?: ìƒëµ
    - ë°˜í™˜íƒ€ì…: *
    - ì„ ì–¸íƒ€ì…?: ìƒëµ
    - ë©”ì„œë“œì´ë¦„: *
    - íŒŒë¼ë¯¸í„°: (..)
    - ì˜ˆì™¸?: ì—†ìŒ

- ë©”ì„œë“œ ì´ë¦„ ë§¤ì¹­ ì˜ˆì‹œ

  ```java
    @Test
    void nameMatchStar2() {
        //ë©”ì„œë“œ ì´ë¦„ ì• ë’¤ì— * ì„ ì‚¬ìš©í•´ì„œ ë§¤ì¹­í•  ìˆ˜ ìˆë‹¤.
        pointcut.setExpression("execution(* *el*(..))");
        assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();
    }
  ```

- `hello.aop.member.*(1).*(2)`
  - ì—¬ê¸°ì„œ 1ë²ˆì€ íƒ€ì…/class ë¥¼ ë§í•˜ê³  2ë²ˆì€ method ëª…ì„
  - > codeë‘ ê°™ì´ ë³´ë©´ì´í•´ë¨
  - > codeëŠ” ExecutionTest

- í¬ì¸íŠ¸ì»· execution ë¬¸ë²•ì—ì„œ íŒ¨í‚¤ì§€ê²½ë¡œëŠ” ë‚˜íƒ€ë‚´ëŠ” `. , ..` ì˜ ì°¨ì´ë¥¼ ì´í•´í•´ì•¼ í•œë‹¤
  - `.` : ì •í™•í•˜ê²Œ í•´ë‹¹ ìœ„ì¹˜ì˜ íŒ¨í‚¤ì§€
  - `..` : í•´ë‹¹ ìœ„ì¹˜ì˜ íŒ¨í‚¤ì§€ì™€ ê·¸ í•˜ìœ„ íŒ¨í‚¤ì§€ë„ í¬í•¨

ì—¬ê¸°ëŠ” ì½”ë“œ ì°¸ì¡°í•˜ëŠ”ê²Œ ì¢‹ìŒ. ì£¼ì„ ë‹¬ì•„ë‘ 

## execution - 2 (9)

- ê°œìš”
  - typeë§¤ì¹­ ì†Œê°œ
  - íŒŒë¼ë©”í„° ë§¤ì¹­ ì†Œê°œ

- ê°„ë‹¨ ì˜ˆì‹œ  (ì´ê±´ ë‹¹ì—°í•œ ì˜ˆì‹œ)

  ```java
      // typeì€ classë¥¼ ë§í•˜ëŠ”ê±°. ë³´ë©´ ì •í™•í•˜ê²Œ ë§¤ì¹­ëœë‹¤. 
      // MemberServiceImpl.* ì—ì„œ .ë’¤ì˜ *ëŠ” methodëª…ì— ë§¤ì¹­ë¨
      @Test
      void typeExactMatch() {
          pointcut.setExpression("execution(* hello.aop.member.MemberServiceImpl.*(..))");
          assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();
      }
  ```

- ì•„ë˜ ì˜ˆì‹œê°€ ì¤‘ìš”

  ```java
    pointcut.setExpression("execution(* hello.aop.member.MemberService.*(..))");
    // helloMethod ëŠ” MemberService interfaceì— ìˆìŒ. ê·¸ë˜ì„œ ë§¤ì¹­ì´ ë¨ (ë¶€ëª¨ íƒ€ì…ì— ë§¤ì¹­ ê°€ëŠ¥)
    // ë‹¹ì—°í•œ ë§ì´ê¸´ í•œë°, ë§Œì•½ helloMethodê°€ MemberServiceì— ì—†ì—ˆë‹¤ë©´ falseì„
    assertThat(pointcut.matches(helloMethod, MemberServiceImpl.class)).isTrue();

  ```

- íŒŒë¼ë©”í„° ë§¤ì¹­
  - ì•ì„œ ì‚¬ìš©í–ˆë˜ íŒŒë¼ë©”í„°ì˜ `(..)`ëŠ” ëª¨ë“  íŒŒë¼ë©”í„°ì— ë§¤ì¹­ëœë‹¤ëŠ”ê²ƒ
    - > ì¦‰, ì´ê±°ëŠ” íŒŒë¼ë©”í„°ê°€ ì—†ëŠ” ì¼€ì´ìŠ¤ë„ í¬í•¨ëœë‹¤.
  - `()`ëŠ” íŒŒë¼ë©”í„°ê°€ ì—†ë‹¤ëŠ” ì˜ë¯¸ --> ì½”ë“œì—ì„œ ì‚¬ìš©ëœ ëª¨ìŠµì„ ì°¸ì¡°í•˜ê¸° ë°”ëŒ
  - `"execution(* *(String, ..))"`
    - ìš”ê±° ì´í•´í•˜ë©´ ë --> ì½”ë“œë‚˜ pdf ì°¸ì¡° í•˜ê¸° ë°”ëŒ

- execution íŒŒë¼ë¯¸í„° ë§¤ì¹­ ê·œì¹™ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.
  - (String) : ì •í™•í•˜ê²Œ String íƒ€ì… íŒŒë¼ë¯¸í„°
  - () : íŒŒë¼ë¯¸í„°ê°€ ì—†ì–´ì•¼ í•œë‹¤.
  - (*) : ì •í™•íˆ í•˜ë‚˜ì˜ íŒŒë¼ë¯¸í„°, ë‹¨ ëª¨ë“  íƒ€ì…ì„ í—ˆìš©í•œë‹¤.
  - `(*, *)` : ì •í™•íˆ ë‘ ê°œì˜ íŒŒë¼ë¯¸í„°, ë‹¨ ëª¨ë“  íƒ€ì…ì„ í—ˆìš©í•œë‹¤.
  - (..) : ìˆ«ìì™€ ë¬´ê´€í•˜ê²Œ ëª¨ë“  íŒŒë¼ë¯¸í„°, ëª¨ë“  íƒ€ì…ì„ í—ˆìš©í•œë‹¤.
    ì°¸ê³ ë¡œ íŒŒë¼ë¯¸í„°ê°€ ì—†ì–´ë„ ëœë‹¤. 0..* ë¡œì´í•´í•˜ë©´ ëœë‹¤.
  - (String, ..) : String íƒ€ì…ìœ¼ë¡œ ì‹œì‘í•´ì•¼ í•œë‹¤. ìˆ«ìì™€ ë¬´ê´€í•˜ê²Œ ëª¨ë“  íŒŒë¼ë¯¸í„°, ëª¨ë“  íƒ€ì…ì„ í—ˆìš©í•œë‹¤.
    ì˜ˆ) (String) , (String, Xxx) , (String, Xxx, Xxx) í—ˆìš©

## within (12)

- ê°œìš”
  - within PCD ì†Œê°œ
  
- within
  - í•´ë‹¹ íƒ€ì…(class)ì´ ë§¤ì¹­ë˜ë©´ **ê·¸ ì•ˆì˜ ë©”ì„œë“œ(ì¡°ì¸ í¬ì¸íŠ¸)ë“¤**ì´ ìë™ìœ¼ë¡œ ë§¤ì¹­ëœë‹¤.
  - ë¬¸ë²•ì€ ë‹¨ìˆœí•œë° execution ì—ì„œ íƒ€ì… ë¶€ë¶„ë§Œ ì‚¬ìš©í•œë‹¤ê³  ë³´ë©´ ëœ
  - > ì˜ì‚¬ìš© ì•ˆí•˜ëŠ” PCDì„

- ì£¼ì˜ì ! ğŸ‘
  - within ì‚¬ìš©ì‹œ ì£¼ì˜í•´ì•¼ í•  ì ì´ ìˆë‹¤. í‘œí˜„ì‹ì— ë¶€ëª¨ íƒ€ì…ì„ ì§€ì •í•˜ë©´ ì•ˆëœë‹¤ëŠ” ì ì´ë‹¤.
  - ì •í™•í•˜ê²Œ íƒ€ì…ì´ ë§ì•„ì•¼ í•œë‹¤. ì´ ë¶€ë¶„ì—ì„œ execution ê³¼ ì°¨ì´ê°€ ë‚œë‹¤.

ë¬¸ë²• ìì²´ëŠ” ì‰½ë„¤, ë§í•œëŒ€ë¡œ execution ë¬¸ë²•ì˜ íƒ€ì… ë¶€ë¶„ë§Œ ì‚¬ìš©í•¨
  
ì—¬íŠ¼ ì´ê±°ëŠ” ì˜ì‚¬ìš©ì•ˆí•¨. ì´ê±° ëŒ€ì‹  executionì„ ì“°ê²Œë¨. ë³„ì´ìœ  ë•Œë¬¸ì— ê·¸ëŸ°ê±´ ì•„ë‹ˆê³   
withinì— ì ìš©í• ìˆ˜ ìˆëŠ” ë¬¸ë²•ì´ typeì—ë§Œ í•œì •ë˜ì–´ì„œ.. ê·¸ë¦¬ê³  ì¸í„°í˜ì´ìŠ¤ë¥¼ ëŒ€ìƒìœ¼ë¡œ í¬ì¸íŠ¸ì»·ì„ ê±¸ê¸°ë„ í•˜ëŠ”ë°
executionìœ¼ë¡œëŠ” ë˜ë„, withinìœ¼ë¡œëŠ” ì•ˆë¨..

## args (14)

- ê°œìš”
  - args ì†Œê°œ
  - ArgsTest ì‘ì„±í•¨
  - > ê·¼ë° withinì²˜ëŸ¼ ë”±íˆ ì¤‘ìš”í•œ ê²ƒì€ ì•„ë‹Œê°€ë´„

- args
  - withinì€ execution ì˜ íƒ€ì… ë¶€ë¶„ë§Œìœ¼ë¡œ ë§¤ì¹­í•˜ëŠ”ê±°ë¼ë©´
  - argsëŠ” executionì˜ param ë¶€ë¶„ë§Œìœ¼ë¡œ ë§¤ì¹­í•˜ëŠ”ê²ƒ
    - > ê·¼ë° executionì˜ param ë§¤ì¹­ì´ë‘ì€ ì°¨ì´ê°€ ìˆë‹¤. ì•½ê°„
  
- ê¸°ë³¸ ë¬¸ë²•ì€ execution ì˜ args ë¶€ë¶„ê³¼ ê°™ë‹¤
- executionê³¼ argsì˜ ì°¨ì´ì 
  - execution ì€ íŒŒë¼ë¯¸í„° íƒ€ì…ì´ ì •í™•í•˜ê²Œ ë§¤ì¹­ë˜ì–´ì•¼ í•œë‹¤.
  - execution ì€ í´ë˜ìŠ¤ì— ì„ ì–¸ëœ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ íŒë‹¨í•œë‹¤.
  - args ëŠ” ë¶€ëª¨ íƒ€ì…ì„ í—ˆìš©í•œë‹¤. args ëŠ” **ì‹¤ì œ ë„˜ì–´ì˜¨ íŒŒë¼ë¯¸í„° ê°ì²´ ì¸ìŠ¤í„´ìŠ¤**ë¥¼ ë³´ê³  íŒë‹¨í•œë‹¤
  - > executionì˜ ê²½ìš° ë¬¸ë²•ì—ì„œ íƒ€ì…(class) ë¶€ë¶„ì€ ë¶€ëª¨ classë¡œ ë°›ëŠ”ê²Œ ê°€ëŠ¥í–ˆìŒ
  - > ê·¼ë° paramì˜ ê²½ìš° Methodì— ì„ ì–¸ëœ param typeì´ë‘ ë¬¸ë²•ìœ¼ë¡œ ëª…ì‹œí•œ typeì´ ì •í™•íˆ ì¼ì¹˜í•´ì•¼í–ˆìŒ
  - > argsëŠ” í´ë˜ìŠ¤ì— ì„ ì–¸ëœ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë§¤ì¹­í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼, ì‹¤ì œ ë„˜ì–´ì˜¨ ê°ì²´ë¥¼ ë³´ê³  íŒë‹¨í•˜ë‹ˆê¹Œ, ë¶€ëª¨ íƒ€ì… ë§¤ì¹­ ê°€ëŠ¥

- `args(java.io.Serializable): ëŸ°íƒ€ì„ì— ì „ë‹¬ëœ ì¸ìˆ˜ë¡œ íŒë‹¨ (ë™ì )`
  - ì´ ë§ì€ ì‹¤ì œ ê°ì²´ê°€ ë„˜ì–´ì™€ì•¼ í¬ì¸íŠ¸ì»· true, false íŒë‹¨ ëœë‹¤ëŠ”ê²ƒ
  - > ë¬¼ë¡  argsì˜ ê²½ìš° testëŠ” method handleë¡œ ê°€ëŠ¥í–ˆì§€ë§Œ.

- ì°¸ê³ 
  - args ì§€ì‹œìëŠ” ë‹¨ë…ìœ¼ë¡œ ì‚¬ìš©ë˜ê¸° ë³´ë‹¤ëŠ” ë’¤ì—ì„œ ì„¤ëª…í•  íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ì—ì„œ ì£¼ë¡œ ì‚¬ìš©ëœë‹¤.

## @target, @within (17)

- ì•ì„  ë‚´ìš© ë¦¬ë§ˆì¸ë“œ
  - @Around ëŠ” ì–´ë“œë°”ì´ìŠ¤ ì¸ë°, ì´ê±° ì¢…ë¥˜ê°€ 6ê°œì¯¤ ë˜ì—ˆìŒ
  - @Around ì— PCD ë„£ì„ìˆ˜ ìˆëŠ”ë°, ì´ê²Œ ì‹«ìœ¼ë©´ @Pointcutìœ¼ë¡œ ë”°ë¡œ í¬ì¸íŠ¸ì»·ì„ ë¹¼ì„œ ë§Œë“¤ìˆ˜ ìˆìŒ
    - AspectJExpressionPointcut classë¡œ í¬ì¸íŠ¸ì»· ê°ì²´ ë§Œë“œëŠ”ê²ƒì€, advisorë¥¼ ì§ì ‘ ë§Œë“¤ë–„ pointcut, adviceë¥¼ ë„£ì–´ì£¼ëŠ”ë° ì»ì—‡ê³ 
      - ì´ê²½ìš° ProxyFactoryë¥¼ ì´ìš©í–ˆì—‡ì§€..
    - test codeë¡œ ê°•ì˜í•˜ê¸° ìœ„í•´ì„œë„ ì»ìŒ
  - ì–´ë“œë°”ì´ìŠ¤ëŠ” ì ìš© ìˆœì„œê°€ ê¸°ë³¸ì ìœ¼ë¡œ ì—†ìŒ
    - @Orderë¡œ ìˆœì„œ ì ìš©í• ìˆ˜ëŠ” ìˆëŠ”ë°, ì´ê²½ìš° classë‹¨ìœ„ë¡œë§Œ ê°€ëŠ¥
  - @AspectëŠ” ê¸°ë³¸ì ìœ¼ë¡œ beanë“±ë¡ì´ ì•ˆë¨. ë”°ë¼ì„œ ì§ì ‘ ë“±ë¡ì„ í•´ì£¼ì–´ì•¼í•œë‹¤.
    - > ì›ë¦¬ëŠ” bean í›„ì²˜ë¦¬ê¸° ì™€ ê°™ë‹¤ê³  í•˜ì˜€ê³ , proxy projectì—ì„œ ë¹ˆ í›„ì²˜ë¦¬ê¸°ë¥¼ í†µí•œ ì›ë¦¬ë¥¼ ë³´ì„
    - > ê·¼ë° ì´ê±° ì‹¤ì œ ì‘ë™ ë°©ì‹ì€ AspectAop ì°¸ì¡°
  - **classë¥¼ typeì´ë¼ê³ ë„ í•¨** ê·¸ë˜ì„œ ì–´ë…¸í…Œì´ì…˜ ë§Œë“¤ë•Œ `@Target(ElementType.TYPE)` ë¥¼ ë¶™ì´ë©´ classë¥¼ targetìœ¼ë¡œ í•œë‹¤ëŠ”ì˜ë¯¸
    - > @target ê³¼ @Target ì€ ë‹¤ë¦„. ì•ì—ê»€ PCDë„ ë’¤ì—ê»€ ì–´ë…¸í…Œì´ì…˜

- ê°œìš”
  - ì•ì„  withinì€ ê³¼ í˜„ì¬ ë°°ìš¸ @within ëª¨ë‘ PCD ë¬¸ë²•ê·¼ë° ì«Œ ë‹¤ë¦„
    - @withinì€ ì†Œë¬¸ìë¡œ ì‹œì‘í•˜ëŠ”ê±° ì£¼ì˜
  - @target, @within ëª¨ë‘ PCBì²˜ëŸ¼ ì‚¬ìš©ë˜ëŠ” ë¬¸ë²•ì„ ( ì–´ë…¸í…Œì´ì…˜ ì•„ë‹˜)
  - @target , @within ì€ íƒ€ì…ì— ìˆëŠ” ì• ë…¸í…Œì´ì…˜ìœ¼ë¡œ AOP ì ìš© ì—¬ë¶€ë¥¼ íŒë‹¨í•œë‹¤.
  - > ì´ê²ƒë„ ìƒê°ë³´ë‹¤ ë§ì´ ì‚¬ìš©ë˜ì§€ëŠ” ì•ŠëŠ”ê°€ë´„

- í¬ì¸íŠ¸
  - @target, @within
  - ì˜ˆì‹œ
    - `@Around("@within(hello.aop.member.annotation.ClassAop) ")`
    - @ClassAop ì–´ë…¸í…Œì´ì…˜ì´ ê±¸ë¦° class ì•ˆì˜ ëª¨ë“  ë©”ì†Œë“œê°€ ì¡°ì¸í¬ì¸íŠ¸ ëŒ€ìƒì´ ë¨
      - > ì¦‰, í¬ì¸íŠ¸ì»·ì— ì˜í•´ ê±¸ë¦°ë‹¤ëŠ” ê²ƒ
  - @targetì˜ ê²½ìš° ì¸ìŠ¤í„´ìŠ¤ì˜ ëª¨ë“  ë©”ì†Œë“œ (ë¶€ëª¨ ë©”ì†Œë“œ í¬í•¨)ê°€ ì¡°ì¸í¬ì¸íŠ¸ ëŒ€ìƒì´ ë˜ëŠ”ê±°ê³ 
    - > ì¦‰ @ClassAopê°€ ë¶™ì€ Child classê°€ ìˆë‹¤ë©´, í•´ë‹¹ í´ë˜ìŠ¤ì˜ ë¶€ëª¨ í´ë˜ìŠ¤ ë©”ì†Œë“œ ëª¨ë‘ ì¡°ì¸í¬ì¸íŠ¸ê°€ ë¨ (ì¦‰ ì–´ë“œë°”ì´ìŠ¤ ë¶™ëŠ”ë‹¤ëŠ”ê²ƒ)
  - @withinì¸ ClassAopê°€ ë¶™ì€ classë§Œ ì¡°ì¸í¬ì¸íŠ¸ ëŒ€ìƒì´ ë¨

- í¬ì¸íŠ¸2
  - ì•ì„  ê°•ì¢Œì˜ args, withinì€ í¬ì¸íŠ¸ì»· ê°ì²´ë§Œ ë§Œë“¤ì–´ì„œ match methodë¡œ ì‰½ê²Œ testê°€ëŠ¥í–ˆëŠ”ë°
    - > ì´ë•Œë„ method handleì€ ìˆì—ˆìŒ. ê·¼ë° ì´ë ‡ê²Œ testë¥¼ í–ˆë‹¤ê³  ì •ì ì¸ ì •ë³´ë¡œ pointcutì´ ì ìš©ëœë‹¤ê³  ìƒê°í•˜ëŠ” ê²ƒì€ ì˜¤ì‚° -> args ì²˜ëŸ¼..
  - @target, @withinì˜ ê²½ìš° ì‹¤ì œ ê°ì²´ê°€ ìˆì–´ì•¼ ê¸°ëŠ¥ì„ ë³´ì—¬ ì¤„ìˆ˜ ìˆì–´ì„œ, targetì´ ë  beanê¹Œì§€ ë§Œë“¤ì–´ì„œ testë¥¼ í•˜ì˜€ë‹¤.
    - > ê·¸ëƒ¥ ë‹¨ìˆœíˆ Annotationì„ classëŒ€ìƒìœ¼ë¡œ ê±¸ì–´ì•¼ í•´ì„œ beanì„ ë§Œë“ ê²Œ ì•„ë‹Œê°€ ì‹¶ë„¤.
    - @targetì˜ ê²½ìš° ì¸ìŠ¤í„´ìŠ¤ ê¸°ì¤€ -> ì¦‰ ì¸ìŠ¤í„´ìŠ¤ì— ìˆëŠ” ëª¨ë“  ë©”ì†Œë“œê°€ ì¡°ì¸ í¬ì¸íŠ¸
    - @withinì˜ ê²½ìš° ì •ì ì¸ í´ë˜ìŠ¤ ì •ë³´ë§Œ ë³´ê³  íŒë‹¨ -> ì¦‰ ì–´ë…¸í…Œì´ì…˜ ê±¸ë¦° classì˜ ë©”ì†Œë“œë§Œ ì¡°ì¸ í¬ì¸íŠ¸
  - > í¬ê²Œ ì¤‘ìš”í•˜ì§€ëŠ” ì•ŠìŒ

- ì°¸ê³ 
  - @target , @within ì§€ì‹œìëŠ” ë’¤ì—ì„œ ì„¤ëª…í•  íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ì—ì„œ í•¨ê»˜ ì‚¬ìš©ëœë‹¤.

- ì£¼ì˜
  - ë‹¤ìŒ í¬ì¸íŠ¸ì»· ì§€ì‹œìëŠ” ë‹¨ë…ìœ¼ë¡œ ì‚¬ìš©í•˜ë©´ ì•ˆëœë‹¤. `args, @args, @target`
  - > pdfë‚´ìš©ë„ ì«Œ ëª¨í˜¸í•œë°
  - > ì •ë¦¬í•˜ìë©´ ìœ„ PCDê°™ì€ê²½ìš°, ìœ„ PCDì— ì˜í•´ ì–´ë“œë°”ì´ìŠ¤ê°€ ì ìš©ë˜ì—ˆëŠ”ì§€ ì•„ë‹Œì§€ëŠ” ì‹¤í–‰ ì‹œì ì—ë§Œ ì•Œìˆ˜ ìˆìŒ
    - > argsëŠ” ì•„ë‹ˆì§€ ì•Šë‚˜?
  - > ë”°ë¼ì„œ AnnotationAwareAspectJAutoProxyCreator(ìë™ í”„ë¡ì‹œ ìƒì„±ê¸°) ì—ì„œ í¬ì¸íŠ¸ ì»·ìœ¼ë¡œ í”„ë¡ì‹œë¥¼ ë§Œë“¤ì§€ ë§ì§€ ê²°ì •í•´ì•¼í•˜ëŠ”ë°,
    - > ë¹ˆí›„ì²˜ë¦¬ê¸°.md ë‚´ìš©
  - > ìœ„ì— ê²ƒë“¤ì€ ëª¨ë‘ trueë¡œ íŒë‹¨í•´ì„œ ìŠ¤í”„ë§ì— ì˜¬ë¼ì˜¤ëŠ” ëª¨ë“  beanì„ í”„ë¡ì‹œë¡œ ë§Œë“¤ë ¤ê³  í•¨. ì´ë•Œ final ì´ ë¶™ì€ class beanì´ ëŒ€ìƒì´ ë˜ë©´
  - > ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.

ì—¬íŠ¼, `args, @args, @target` ëŠ” ëŸ°íƒ€ì„ì— ë„˜ì–´ì˜¨ ì¸ìˆ˜/ê°ì²´ê°€ ìˆì–´ì•¼ í•œë‹¤ëŠ” ì‚¬ì‹¤ë§Œ ê¸°ì–µí•˜ë©´ ë ê±° ê°™ë‹¤.  

- ì˜ê²¬
  - > ì¶”ê°€ì ìœ¼ë¡œ @target, @withinì€ target, within PCDì¸ë° ì•„ë§ˆ annotation ë¶™ì€ê±¸ ëŒ€ìƒìœ¼ë¡œ í•œë‹¤ëŠ” ì˜ë¯¸ ê°™ë‹¤. args, @argsë„ ê°™ì€ ê°œë… ê°™ìŒ

- Q/A ğŸ‘
  - @SpringBootTest ë¥¼ ì‚¬ìš©í•˜ë©´ì„œ ê·¸ì•ˆ inner í´ë˜ìŠ¤ì—  @Configurationë¥¼ ë¶™ì—¬ì„œ beanì„ ë“±ë¡í–ˆë”ë‹ˆ AOPê°€ ì ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤..?
    - @Configurationì„ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ ìŠ¤í”„ë§ ë¶€íŠ¸ì˜ ë‹¤ì–‘í•œ ì„¤ì •ë“¤ì´ ë¨¹íˆì§€ ì•Šê³ , @Configuration ì•ˆì—ì„œë§Œ ì ìš©í•œ ì„¤ì •ì´ ë¨¹íˆê²Œ ë©ë‹ˆë‹¤.
    - ì´ ì„¤ì •ì´ ìš°ì„ ê¶Œì„ ê°€ì§€ê³  ê°€ë²„ë¦¬ê¸° ë•Œë¬¸ì— ìŠ¤í”„ë§ ë¶€íŠ¸ì˜ ë‹¤ë¥¸ ì„¤ì •ì´ ì ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    - ì‰½ê²Œ ì´ì•¼ê¸°í•´ì„œ í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ì´ ì„¤ì •ë§Œ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.
    - ì—¬ê¸°ì„œ ë¬¸ì œëŠ” ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ ë§Œë“¤ì–´ì£¼ëŠ” AOP ê´€ë ¨ ê¸°ë³¸ í´ë˜ìŠ¤ë“¤ë„ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡ë˜ì§€ ì•Šê³ ,
    - ê²°êµ­ AOP ìì²´ê°€ ë™ì‘í•˜ì§€ ì•Šê²Œ ëœë‹¤ëŠ” ì ì…ë‹ˆë‹¤. (ê°•ì˜ì—ì„œ ë§ì”€ë“œë¦° AutoProxyê°€ ìˆì–´ì•¼ AOPë¥¼ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)
    - ê·¸ëŸ¬ë©´ AOPê°€ ë™ì‘í•˜ë„ë¡ í•˜ëŠ” ê¸°ëŠ¥ë“¤ì„ ë“±ë¡í•˜ë©´ ë˜ê² ì§€ìš”?
    - ë°”ë¡œ @EnableAspectJAutoProxyë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì§ì ‘ ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.
    - ê·¸ëŸ¬ë©´ AOPê°€ ì ìš©ë˜ë©´ì„œ ì •ìƒ ë™ì‘í•˜ê²Œ ë©ë‹ˆë‹¤

    ```java
    @EnableAspectJAutoProxy
    @Configuration
    static class InnerConfig {
    }
        
    ```

    - ê·¸ëŸ°ë° ì´ë ‡ê²Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ë§ì´ ë²ˆê±°ë¡­ìŠµë‹ˆë‹¤.
    - ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ìŠ¤í”„ë§ ë¶€íŠ¸ì˜ ê¸°ë³¸ ê¸°ëŠ¥ì„ ì„¤ì •ì„ ì‚¬ìš©í•˜ë©´ì„œ ê·¸ ìœ„ì— ì›í•˜ëŠ” ì„¤ì •ì„ ë”í•˜ëŠ” ë°©ë²•ë„ ì œê³µí•©ë‹ˆë‹¤.
    - ë°”ë¡œ @TestConfigurationì„ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

    ```java
    @TestConfiguration
    static class InnerConfig {
    }
    ```

## @annotation, @args (20)

- ë¦¬ë§ˆì¸ë“œ
  - @Aspect - @Aroundë¡œ proxy ìƒì„±
    - @Aspect ë¶™ì¸ classëŠ” ë¹ˆë“±ë¡ì„ í•´ì¤˜ì•¼í•¨.
      - ìë™ í”„ë¡ì‹œ ìƒì„±ê¸°(ë¹ˆí›„ì²˜ë¦¬ê¸°) ê°€ ì´ê±°ë‘ Advisor ë¹ˆë“¤ ì„ ì²˜ë¦¬í•´ì¤Œ
    - @Aroundì—ëŠ” í¬ì¸íŠ¸ì»·ë‚´ìš©(PCD)ë¥¼ ì‘ì„±í•´ì£¼ê³ , method bodyì— advice ë‚´ìš©ì„ ì‘ì„±
    - ì´ë–„ adviceì˜ ë°˜í™˜ì€ Object ì´ë‹¤.
      - @Around ì™¸ ë‚˜ë¨¸ì§€ 5ê°œ ì–´ë“œë°”ì´ìŠ¤ ë§Œë“¤ë• returnì´ voidì„.

- ê°œìš”
  - @annotation ëŠ” ë©”ì†Œë“œì— ê±¸ë¦° annotationì„ ë³´ê³  íŒë‹¨í•˜ëŠ” PCD
  - ì•ì„  ê°•ì¢Œì˜ @target, @within ëŠ” í´ë˜ìŠ¤ì— ê±¸ë¦° ì–´ë…¸í…Œì´ì…˜ì„ ë³´ê³  íŒë‹¨í•˜ëŠ” ê±°ì˜€ìŒ
  - > ì´ê±´ ê°€ë” ì“°ì¸ë‹¤ê³  í•¨
  - > í•´ë³´ë‹ˆ ê°„ë‹¨í•¨

- @args ëŠ” ì˜ˆì œ ì—†ì´ ì„¤ëª…ë§Œ ì§„í–‰
  - `@args(test.Check)`
    - ì „ë‹¬ëœ ì¸ìˆ˜ì˜ ëŸ°íƒ€ì„ íƒ€ì…ì— @Check ì• ë…¸í…Œì´ì…˜ì´ ìˆëŠ” ê²½ìš°ì— ë§¤ì¹­í•œë‹¤.
    - ì¦‰, ëŸ°íƒ€ì„ì‹œ `MemberService.hello(ClassA)` ë€ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œê²½ìš° íŒŒë¼ë©”í„°ì¸ ClassAì— @Checkê°€ ë¶™ì–´ìˆìœ¼ë©´ ë§¤ì¹­ë˜ì„œ í˜¸ì¶œë¨
  - > ì˜ ì•ˆì”€

## bean (23)

- ê°œìš”
  - **ìŠ¤í”„ë§ ë¹ˆì˜ ì´ë¦„**ìœ¼ë¡œ AOP ì ìš© ì—¬ë¶€ë¥¼ ì§€ì •í•œë‹¤. ì´ê²ƒì€ ìŠ¤í”„ë§ì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” íŠ¹ë³„í•œ ì§€ì‹œìì´ë‹¤
  - ì¦‰ aspectj ê°™ì€ë´ ìˆëŠ”ê²Œ ì•„ë‹˜

- í¬ì¸íŠ¸
  - ì•„ë˜ì™€ ê°™ì´ ì”€
  - > ê·¼ë° ì—­ì‹œ ì˜ ì“°ëŠ”ê±´ ì•„ë‹ˆë¼ê³  í•¨
  - `@Around("bean(orderService) || bean(*Repository)")`

## ë§¤ê°œë³€ìˆ˜ ì „ë‹¬ (24)

- ê°œìš”
  - ì–´ë“œë°”ì´ìŠ¤ì— ë§¤ê°œë³€ìˆ˜ ì „ë‹¬í•˜ëŠ” ë°©ë²•
    - > ê·¼ë° method í˜¸ì¶œì— ì“°ëŠ” paramì€ ProceedingJoinPoint ë¡œ ë°›ì„ìˆ˜ ìˆì°Œ ì•Šë‚˜? getArgs methodì§€ì›ë˜ëŠ”ë°..
    - > ë§ìŒ ê°•ì˜ì—ì„œë„ ë‚˜ì˜´
  - > ì¤‘ìš”í•˜ë‹¤ê³  í•¨
  - args PCD ì‚¬ìš©ë²•ì´ë‘ ë‹¤ì‹œ ë¹„êµí•´ë³´ë©´ì„œ ë³´ëŠ”ê²Œ ì¢‹ìŒ

- ì¤‘ìš” í¬ì¸íŠ¸ ğŸ‘
  - ProceedingJoinPoint ë¡œ paramì„ êº¼ë‚¼ìˆ˜ ìˆëŠ”ë° ì´ëŸ¬ë©´ **ê°€ë…ì„±ì´ ì¢‹ì§€ê°€ ì•Šë‹¤.**
  - ê·¸ë˜ì„œ í¬ì¸íŠ¸ì»· ë§¤ê°œë³€ìˆ˜ ì „ë‹¬ì„ ì´ìš©í•¨

  ```java
  @Around("allMember()")
  public Object logArgs1(ProceedingJoinPoint joinPoint) throws Throwable {
      // [*] ì—­ì‹œ ìƒê°í•œ ëŒ€ë¡œ joinPointë¥¼ ì´ìš©í•´ì„œ paramê°’ ê°€ì ¸ì˜¬ìˆ˜ ìˆë„¤
      // [*] ê·¼ë° ì´ë ‡ê²Œ ë½‘ëŠ”ê±°ëŠ” ê°€ë…ì„±ì´ ì¢‹ì§€ê°€ ì•Šë‹¤.
      Object arg1 = joinPoint.getArgs()[0];
      log.info("[logArgs1]{}, arg={}", joinPoint.getSignature(), arg1);
      return joinPoint.proceed();
  }
  ```

- í¬ì¸íŠ¸
  - ì—¬ê¸°ì„œ thisì™€ targetë„ ì˜ˆì‹œë¡œ ì¼ë¶€ ë³´ì—¬ì¤Œ

- ë¦¬ë§ˆì¸ë“œ ğŸ¥‰
  - springì€ proxyFactoryë¥¼ ë§Œë“¤ë•Œ interface ê¸°ë°˜ classê°€ targetì´ì–´ë„ cglibì„ ì´ìš©í•œë‹¤ê³  í–ˆìŒ
  - ì—¬ê¸° ì˜ˆì‹œì¸ MemberServiceImpleë„ interface ê¸°ë°˜ì¸ë°, ì‹¤ì œ í”„ë¡ì‹œ ë§Œë“¤ì–´ì§„ê²ƒì€ ì•„ë˜ì™€ ê°™ë‹¤
    - `class hello.aop.member.MemberServiceImpl$$EnhancerBySpringCGLIB$$99539c87`
    - ì¦‰, MemberServiceImpl ë¥¼ ìƒì†í•´ì„œ ë§Œë“¤ì—ˆë‹¤ê³  ë´ì•¼ í•¨
    - ì‹¤ì œë¡œ superclassë¥¼ ì°ì–´ë³´ë‹ˆ MemberServiceImplê°€ ë‚˜ì˜´
  
ì—¬ê¸°ëŠ” ì¤‘ìš”í•œ pointë“¤ì´ ë§ìŒ ParameterTest classì— ì£¼ì„ ë§ì´ ë‹¬ì•„ë‘ì—ˆìœ¼ë‹ˆ ì°¸ì¡° ë°”ëŒ  

- í¬ì¸íŠ¸2
  - ì•„ë˜ì²˜ëŸ¼ ì–´ë…¸í…Œì´ì…˜ value êº¼ë‚´ëŠ”ê±° ì¢…ì¢… ì“¸ë§Œí•˜ë‹¤ê³  í•¨

  ```java
   @Before("allMember() && @annotation(annotation)")
        public void atAnnotation(JoinPoint joinPoint, MethodAop annotation) {
            log.info("[@annotation]{}, annotationValue={}", joinPoint.getSignature(), annotation.value());
        }
  ```
  
ë‹¤ìŒ ì ˆì˜ this, targetì€ ì˜ ì“°ì§€ëŠ” ì•ŠëŠ”ë°, ë‚´ìš©ì´ ë³µì¡í•˜ë‹¤ê³  í•¨


## this, target

## ì •ë¦¬
