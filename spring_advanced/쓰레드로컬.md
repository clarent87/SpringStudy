# 쓰레드 로컬

## 필드 동기화 - 개발

- 개요
  - 앞선 hellotrace는 정식 버전의 로그 추적기가 아니었음
  - 따라서 이제 정식 버전의 로그 추적기를 logtrace package에 만든다.
    - > 기존 hellotrace 이용시 traceid동기화가 안되었는데 ( 그래서 method를 전부 수정함 )  
    - > 정식 버전에서는 thread local에 해당 값을 저장하려고 하나봄.. 아직은 이렇게 만들지 않음
  - FieldLogTrace라는 class를 만듬
    - 이제 직전 로그의 TraceId 는 파라미터로 전달되는 것이 아니라 FieldLogTrace 의 필드인 traceIdHolder 에 저장된다.
    - 여기서 중요한 부분은 로그를 시작할 때 호출하는 syncTraceId() 와 로그를 종료할 때 호출하는 releaseTraceId() 이다.

- 쓰레드 로컬 이란? (cpp 기준)
  - 쓰레드 별 static 영역
  - 이거 binary에서 보면 heap은 영역이 없었는데, static 영역은 있었음. 이거 라고 보면 되는듯.
  - > 그리고 이거 만들기 위한 keyword는 컴파일러 별로 다른거 같음. cpp 강좌에서는 OS별로 keyword가 다르다고 했는데. 이게 컴파일러영향인듯

## 필드 동기화 - 적용 (6)

- 개요
  - app v3에 만든 FieldLogTrace적용

- 실무
  - pdf에 아래 문구가 있음
    -  traceIdHolder 필드를 사용한 덕분에 파라미터 추가 없는 깔끔한 로그 추적기를 완성했다. 이제 실제 서비스에 배포한다고 가정해보자.
    -  > 동시성 문제
  - 면접 질문이고, 이것때문에 일년에 한번씩 문제를 겪는다고함

## 필드 동기화 - 동시성 문제 (11)

## 동시성 문제 - 예제 코드