# 검증1

## 검증 요구사항

**컨트롤러의 중요한 역할중 하나는 HTTP 요청이 정상인지 검증하는 것이다.**

## 프로젝트 설정 V1

## 검증 직접 처리 - 소개 (3)

- > 검증 로직은 컨트롤러에서 돌리는게 정석인가봄

## 검증 직접 처리 - 개발 (4)

- > 직접 ModelAttribute 로온 값을 일일이 검증함 if문으로..
- ModelAttribute의 경우 param을 이미 model에 담아서 전달해주는것
- add GetMapping method에서 보면 `new Item()`을 이용해서 view를 만들었는데. 그이유가 이제 나옴
  - 사용자가 form에서 에러 냈을때, 에러 내용을 그대로 다시 해당 view로 전달가능. ( 해당 뷰가 item 기반으로 이미 만들어져서..)
    - > PostMapping add의 예를 보면 이해 될것. 

- `th:class="${errors?.containsKey('itemName')} ? 'form-control field-error' : 'form-control'"`
  - errors가 null이 아니고 itemName이 있으면 class=form-control field-error
    - class에 style이 두개가 중첩되나봄.
  - ? 는 Safe navigation operator라고 한다. pdf에 나옴
    - getmapping add에서는 errors가 넘어가지 않아서 null이기 때문에 ? 연산자를 활용해 주어야함
    - > 이거 springEL 문법임!! 👍
  - 에러 보여주는 부분을 classappend를 이용해서 좀더 단순화 할수 있음 (classappend는 타입리브 설명에서 나온듯. )
  ```html
  <input type="text" th:classappend="${errors?.containsKey('itemName')} ? 'fielderror' : _" class="form-control">
  ```

여기까지 요구사항에 따른 검증은 진행되었는데, 타입오류 같은것은 처리가 안됨  
타입오류는 컨트롤러 호출전에 터지는거. ( param에 값을 못넣어주니까..)  
뒤에서는 이런 상황에서도 컨트롤러로 진입하는거 알려주나봄 -> pdf 참조. 잘나옴 👍    
특히 사용자가 Integer에 String 입력했을때.. 이거 잘못입력한거 다시 보여 줘야하는데.. 어찌??? -> 이런거 해결책도 뒤에 나옴
  
정확히 이해하려면 역시 단계별 개발이 필요

## 프로젝트 준비 V2 (11)

## BindingResult1 (12)

- 앞에서 Errors Map을 이용했었는데, 이거 대신 spring에서 제공하는 BindingResult를 사용한다. 
  - 즉. spring에서 Errors Map이랑 같은 개념의 것을 지원해 주는것. 
  - 앞 예제에서는 Errors map에 에러난(요구사항 만족안하는) 내용을 담고 model.addAttribute로 errors를 뷰에 넘겼었음

- BindingResult가 핵심
  - `BindingResult bindingResult 파라미터의 위치는 @ModelAttribute Item item 다음에 와야 한다`
    - > 순서가 매우 중요!!!!

- 타입리프에서 BindingResult에 접근하는 문법이 있네.
  - `#fields`
- `<div class="field-error" th:errors="*{itemName}"> `
  - `new FieldError("item","itemName","상품 이름은 필수입니다.")`에 보면 itemName라고 필드 이름을 주었기 때문에
  - `th:errors="*{itemName}"` 로 쓸수 있음
  - > th:object가 있어서 *{..}를 쓸수 있는거 같음 th:errors에 명시하는 필드명은 FieldError에 넘긴거.. 
  - > 여튼 new FieldError로 itemName가 넘어왔다면 error가 난것으로 인식
- `th:errorclass="field-error"`
  - `th:field="*{itemName}"` 때문에 itemName이 에러인지 아닌지 판단가능하다함. `th:errors`에서는 필드명을 명시 했었음
  - > 즉 errorclass에서 판단하는 에러 필드명은 itemName
  - 여튼 에러가 있으면"field-error" 를 class tag에 추가해줌

## BindingResult2 (16)
