# bean validation

## ì†Œê°œ

- jpa vs í•˜ì´ë²„ë„¤ì´íŠ¸ ì™€ ê°™ì€ ê´€ê³„ê°€ Bean Validation vs í•˜ì´ë²„ë„¤ì´íŠ¸ validator ì´ë‹¤.
  - > pdfì— ë§í¬ ìˆëŠ”ë° í•˜ì´ë²„ë„¤ì´íŠ¸ validatorê°€ ì œê³µí•˜ëŠ” ê²€ì¦ annotationë“¤ì´ ë‚˜ì™€ ìˆìŒ

## ì‹œì‘ (2)

bean validation ë™ì‘ ì›ë¦¬ í™•ì¸.  
validation í”„ë¡œì íŠ¸ì— test ì½”ë“œë¡œ ì¶”ê°€í•¨.

## Bean Validation - ìŠ¤í”„ë§ ì ìš© (7)

springì— í†µí•©ë˜ì–´ validationì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•  
> ì•„ì§ê¹Œì§€ëŠ” bindingResultì— ì—ëŸ¬ê°€ ì¶”ê°€ë˜ëŠ”ê²Œ ì „ë¶€ ì¸ê±° ê°™ìŒ. rest apiì—ì„œ ì“°ë ¤ë©´ biningResultë¥¼ ì—´ì–´ë³´ë©´ë˜ëŠ”ê±´ê°€?  
> ì´ê±° ì—´ì–´ì„œ ì—ëŸ¬ ì„¸íŒ…ë˜ì–´ ìˆìœ¼ë©´ http responseë¥¼ ë‹¤ë¥´ê²Œ ì „ë‹¬?  
> ê·¼ë° ì•„ì§ ê¹Œì§€ëŠ” req paramì— ëŒ€í•´ì„œë§Œ ì§„í–‰í•œê±°. ModelAttribute ì´ê±°ì´ìš©í•´ì„œ

- ì£¼ì˜! webmvcconfigë¡œ ì§ì ‘ validatorë“±ë¡í•˜ë©´ ìŠ¤í”„ë§ì´ ìë™ìœ¼ë¡œ ë“±ë¡í•˜ëŠ” LocalValidatorFactoryBeanê°€ ë“±ë¡ì´ ì•ˆë˜ì„œ
  ì–´ë…¸í…Œì´ì…˜ ê¸°ë°˜ validationì„ ëª»ì”€

- spring mvc ê²€ì¦ ìˆœì„œ
  1. ë°”ì¸ë”©
  2. validator
     1. ë°”ì¸ë”©ì´ ì•ì„œ ì„±ê³µí•œ í•„ë“œë§Œ ì´ê²Œ ë™ì‘.. ë‹¹ì—°í•œ ì–˜ê¸°

## Bean Validation - ì—ëŸ¬ì½”ë“œ (11)

ì–´ë…¸í…Œì´ì…˜ ê¸°ë°˜ validation ì´ìš©í–ˆì„ë•Œ, ì—ëŸ¬ ë©”ì‹œì§€ ìˆ˜ì •í•˜ëŠ”ë²•
  
ì—ëŸ¬ ë‚´ê³  ì°ì–´ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ ë‚˜ì˜´  
```
Field error in object 'item' on field 'itemName': rejected value []; codes [NotBlank.item.itemName,NotBlank.itemName,NotBlank.java.lang.String,NotBlank]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [item.itemName,itemName]; arguments []; default message [itemName]]; default message [ê³µë°±X] 
```

ì¦‰ NotBlankì— ëŒ€í•œ ì—ëŸ¬ë©”ì‹œì§€ëŠ” propertiesì— NotBlank ë¡œ ë ˆë²¨ë§Œë“¤ì–´ ë‘ë©´ë˜ëŠ”ë“¯.
- ì—ëŸ¬ëŠ” ë ˆë²¨ì„ ë‚˜ëˆ„ì–´ ë§Œë“œëŠ”ê²ƒì´ ì¢‹ë‹¤ê³  í–ˆìŒ ì•ìª½ ê°•ì˜ì—ì„œ
- ê·¸ë¦¬ê³  ìì„¸íˆ ì°ì„ ì• ë“¤ì€ ìì„¸íˆ ë ˆë²¨ë‚˜ëˆ„ì–´ì„œ ì—ëŸ¬ ë©”ì‹œì§€ ì¤€ë¹„í•˜ê³ , ëŒ€ì¶©í•  ì• ë“¤ì€ Level 4 ë©”ì‹œì§€ë§Œ ì´ìš©  
  
ì•„ë˜ì™€ ê°™ì´ ë©”ì‹œì§€ë¥¼ ì¶”ê°€ í–ˆëŠ”ë° {0} ì€ ìŠ¤í”„ë§ì´ ì—ëŸ¬ë‚œ í•„ë“œì˜ ì´ë¦„ì„ ìë™ìœ¼ë¡œ ì±„ì›Œì¤€ë‹¤.  
ë‚˜ë¨¸ì§€ {1},{2}ë„ ì–´ë…¸í…Œì´ì…˜ì— ì„¸íŒ…í•œ ê°’ `@Range(min=1000,max=10000)` ì´ëŸ°ê±° ë¹¼ì„œ ë„£ì–´ì¤Œ. ë³´ë©´ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ë„˜ì–´ê°„ param ìˆœì„œ..  

```
#Bean Validation ì¶”ê°€
NotBlank={0} ê³µë°±X
Range={0}, {2} ~ {1} í—ˆìš©
Max={0}, ìµœëŒ€ {1}
```  
  

- BeanValidation ë©”ì‹œì§€ ì°¾ëŠ” ìˆœì„œ
  - 1. ìƒì„±ëœ ë©”ì‹œì§€ ì½”ë“œ ìˆœì„œëŒ€ë¡œ messageSource ì—ì„œ ë©”ì‹œì§€ ì°¾ê¸°
  - 2. ì• ë…¸í…Œì´ì…˜ì˜ message ì†ì„± ì‚¬ìš© @NotBlank(message = "ê³µë°±! {0}") 3. ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì œê³µí•˜ëŠ” ê¸°ë³¸ ê°’ ì‚¬ìš© ê³µë°±ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

## Bean Validation - ì˜¤ë¸Œì íŠ¸ ì˜¤ë¥˜ (13)

Bean Validationì—ì„œ íŠ¹ì • í•„ë“œ( FieldError )ê°€ ì•„ë‹Œ í•´ë‹¹ ì˜¤ë¸Œì íŠ¸ ê´€ë ¨ ì˜¤ë¥˜( ObjectError )ëŠ” ì–´ë–»ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆì„ê¹Œ?  -> ` @ScriptAssert()`   
ğŸ‘ ê·¼ë° ì´ê±° ê¸°ëŠ¥ì´ ë„ˆë¬´ ì•½í•´ì„œ. ì‹¤ë¬´ì—ì„œëŠ” ê·¸ëƒ¥ ì›ë˜ í•˜ë˜ëŒ€ë¡œ java codeë¡œ ì§ì ‘ ê²€ì¦í•˜ê³  bindingresultì— ì—ëŸ¬ë¥¼ ì¶”ê°€í•œë‹¤.  
  
> ê·¸ë˜ì„œ field ì—ëŸ¬ëŠ” ì–´ë…¸í…Œì´ì…˜ ê¸°ë°˜ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³ , objectëŠ” java codeë¡œ ë•Œìš´ë‹¤. ë‹¨ ì´ê²½ìš° objectê²€ì¦ ë¡œì§ì€ methodë¡œ ì¶”ì¶œí•˜ëŠ”ê²Œ ì¢‹ë‹¤.  
> object ê²€ì¦ì€, field ì—¬ëŸ¬ê°œ ì¡°í•©í•´ì„œ ìš”êµ¬ì‚¬í•­ ë§Œë“œëŠ” ê·¸ê±°.. ë§í•¨ ì´ê²½ìš° object error ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ bindingresultì— ë„£ì—ˆìŒ
  
ì—¬ê¸°ê¹Œì§€ëŠ” addForm methodì—ë§Œ validationì„ ì ìš©. ì•„ë˜ì„œ ë¶€í„´ editFormì— ì ìš©í•œë‹¤.  

## Bean Validation - ìˆ˜ì •ì— ì ìš© (14)

ê·¸ëƒ¥ editFormì— ì ìš©í•œê²Œ ì „ë¶€.. ê·¸ë¦¬ê³  html ìˆ˜ì •

## Bean Validation - í•œê³„ (18)

bean validationì´ ë§ŒëŠ¥ì´ ì•„ë‹˜. í•œê³„ê°€ ìˆê³  í•´ë‹¹ í•œê³„ë¥¼ ì‹¤ë¬´ì—ì„œ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ëŠ”ì§€ ë‚˜ì˜´  
  
- ë¬¸ì œ
  - ë“±ë¡ ìš”êµ¬ì‚¬í•­ , ìˆ˜ì • ìš”êµ¬ì‚¬í•­ì´ ë‹¤ë¥¸ê²½ìš° Item ê°ì²´ì— ì–´ë…¸í…Œì´ì…˜ì„ ì–´ë–»ê²Œ ì¨ì£¼ì–´ì•¼ í•˜ë‚˜? 
  - ë‹¤ìŒ ì ˆì— ë‚˜ì˜´

## Bean Validation - groups (20)

- ë°©ë²• 
  - 1. bean validation - groups
  - 2. í¼ ì „ì†¡ ê°ì²´ë¥¼ ë¶„ë¦¬í•´ì„œ ë§Œë“¬. ì¦‰ ëª¨ë¸ ê°ì²´ë¥¼ item ì €ì¥ìš©, ìˆ˜ì •ìš©ì„ ë§Œë“ ë‹¤

- groups
  - ` @NotNull(groups = UpdateCheck.class)`
  - ì‚¬ìš© `@Validated(UpdateCheck.class)`
  - `@Valid` ëŠ” ê·¸ë£¹ìŠ¤ ê¸°ëŠ¥ ì—†ë‹¤.

- ì •ë¦¬
  - groups ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì„œ ë“±ë¡ê³¼ ìˆ˜ì •ì‹œì— ê°ê° ë‹¤ë¥´ê²Œ ê²€ì¦ì„ í•  ìˆ˜ ìˆì—ˆë‹¤. 
  - ê·¸ëŸ°ë° groups ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë‹ˆ Item ì€ ë¬¼ë¡ ì´ê³ , ì „ë°˜ì ìœ¼ë¡œ ë³µì¡ë„ê°€ ì˜¬ë¼ê°”ë‹¤.
  - ì‚¬ì‹¤ groups ê¸°ëŠ¥ì€ ì‹¤ì œ ì˜ ì‚¬ìš©ë˜ì§€ëŠ” ì•ŠëŠ”ë°, 
  - ê·¸ ì´ìœ ëŠ” ì‹¤ë¬´ì—ì„œëŠ” ì£¼ë¡œ ë‹¤ìŒì— ë“±ì¥í•˜ëŠ” ë“±ë¡ìš© í¼ ê°ì²´ì™€ ìˆ˜ì •ìš© í¼ ê°ì²´ë¥¼ ë¶„ë¦¬í•´ì„œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì´ë‹¤.
    - > ì‹¤ë¬´ì—ì„œëŠ” item ì €ì¥ì— ì“°ì´ëŠ” ë‚´ìš©ì´ë‘ ìˆ˜ì •ì— ì“°ì´ëŠ” ë‚´ìš©ì´ ì „í˜€ ë‹¤ë¥´ë‹¤ê³ í•¨..

## Form ì „ì†¡ ê°ì²´ ë¶„ë¦¬ - í”„ë¡œì íŠ¸ ì¤€ë¹„ V4 (22)

## Form ì „ì†¡ ê°ì²´ ë¶„ë¦¬ - ì†Œê°œ (23)

pdf ê¼­ ì½ì„ê²ƒ.  
ì‹¤ë¬´ì—ì„œëŠ” "í¼ ë°ì´í„° ì „ë‹¬ì„ ìœ„í•œ ë³„ë„ì˜ ê°ì²´ ì‚¬ìš©"ì„ í•˜ëŠ”ë° ì™œ ì´ë˜ì•¼ í•˜ëŠ”ì§€ ì´ìœ ê°€ ì˜ ë‚˜ì™€ìˆìŒ  
í•´ë‹¹ ê°ì²´ì˜ ì´ë¦„ ì§“ëŠ”ë²•ë„ ë‚˜ì™€ ìˆìŒ

## Form ì „ì†¡ ê°ì²´ ë¶„ë¦¬ - ê°œë°œ (24)

- item ëŒ€ì‹  formì—ì„œ ì˜¤ëŠ” dataë¥¼ ë°›ê¸°ìœ„í•œ classë¥¼ ë§Œë“¤ì—ˆëŠ”ë°, íŒ¨í‚¤ì§€ ìœ„ì¹˜ê°€ ì¤‘ìš”.
  - controllerì—ì„œë§Œ ì“¸êº¼ë¼ì„œ domainì´ ì•„ë‹Œ, web-validation ì•„ë˜ì— form packageë¥¼ ë§Œë“¤ì–´ì„œ ê±°ê¸°ì— ì‘ì„±

> ì´ê²Œ ì‹¤ë¬´ì—ì„œ ë§ì´ ì“°ëŠ” ë°©ë²•
> ê²€ì¦ annotation í•˜ì´ë²„ë„¤ì´íŠ¸ì—ì„œ ì œê³µí•˜ëŠ”ê±° í•œë²ˆ ì­‰ ë³´ëŠ”ê²Œ ì¢‹ë‹¤. (pdfì— ë§í¬ ìˆìŒ ì•ìª½ì—)

## Bean Validation - HTTP ë©”ì‹œì§€ ì»¨ë²„í„°(31)

- Bean validationì„ requestbodyì— ì ìš©í•˜ëŠ” ë°©ë²•  
  - > ë“œë””ì–´ ë‚˜ì˜¤ë„¤!!

- mvc1 ë‚´ìš© ê°„ëµ ì†Œê°œ
  - @RequestMapping ì„ ì´ìš©í•˜ëŠ” ê²½ìš°, ì´ê±° ë””ìŠ¤íŒ¨ì¹˜ì„œë¸”ë¦¿ì—ì„œ í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°(RequestMappingHandlerAdapter) ì°¾ì•„ì„œ ì²˜ë¦¬ í–ˆì—ˆìŒ
    - í•¸ë“¤ëŸ¬ ì°¾ê³ . í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° ì°¾ê³ , í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ì— í•¸ë“¤ëŸ¬ ë„£ì–´ì„œ ì‹¤í–‰í–ˆë˜ë“¯..
    - í•¸ë“¤ëŸ¬ = ì»¨íŠ¸ë¡¤ëŸ¬
  - HTTP ë©”ì‹œì§€ ì»¨ë²„í„° ë™ì‘í•˜ëŠ” ê²½ìš°
    - HTTP ìš”ì²­: @RequestBody , HttpEntity(RequestEntity) ,
    - HTTP ì‘ë‹µ: @ResponseBody , HttpEntity(ResponseEntity) ,
  - í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ì—ì„œ í•¸ë“¤ëŸ¬ í˜¸ì¶œì‹œ argument resolverê°€ ë™ì‘í•´ì„œ í•¸ë“¤ëŸ¬ì˜ paramë“¤(@RequestParam, @ModelAttribute)ì„ ìƒì„±í•´ì„œ ë„˜ê¹€ 
    - ì—¬ê¸°ì„œ http ë©”ì‹œì§€ ì»¨ë²„í„° ë™ì‘
  - ë‹¹ì—°íˆ í•¸ë“¤ëŸ¬ì—ì„œ return í•˜ëŠ” ê²ƒì€ return value handlerê°€ ë™ì‘
    - > ì´í›„ view resolverê°€ ë™ì‘í• ìˆ˜ë„ ì•„ë‹ìˆ˜ë„ ìˆìŒ.
    - ì—¬ê¸°ì„œ http ë©”ì‹œì§€ ì»¨ë²„í„° ë™ì‘
  - arguemtn resoleverë‘ return value handlerê°€ ì§€ì›í•˜ëŠ” íƒ€ì… -> mvc1ì— ë§í¬ ìˆìŒ

- rest api ì ìš©í•  ë•Œ ì£¼ì˜ì 
  - request param ë•Œë‘ì€ ë‹¤ë¥´ê²Œ jsonì„ ê°ì²´ë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •ì´ ì‹¤íŒ¨í•˜ë©´ bindingresultë¡œ ì—ëŸ¬ê°€ ë„˜ì–´ì˜¤ëŠ”ê²Œ ì•„ë‹˜. 
  - ê·¸ëƒ¥ ì—ëŸ¬ëœ¸.
    - > ì´ ì—ëŸ¬ ë©”ì‹œì§€ ë‹¤ë£¨ëŠ”ê²ƒì€ ë’¤ìª½ ê°•ì˜ ì£¼ì œ
    - > ê·¸ëŸ¼ bindingresultë¥¼ ì‚¬ìš©í•˜ëŠ” ì˜ë¯¸ê°€ ìˆë‚˜..
  - ì—ëŸ¬ ë‚´ìš©ì€ ì•„ë˜ ë‚´ìš©

```
resolved [org.springframework.http.converter.HttpMessageNotReadableException: JSON parse error: Unexpected character ('i' (code 105)): was expecting double-quote to start field name; nested exception is com.fasterxml.jackson.core.JsonParseException: Unexpected character ('i' (code 105)): was expecting double-quote to start field name
 at [Source: (PushbackInputStream); line: 1, column: 3]]
```
  
> ê·¼ë° ê²½ìš°ì— ë”°ë¼ì„œ json to object ë§Œë“¤ë–„ ëª‡ëª‡ í•„ë“œëŠ” ë°”ì¸ë”© ì•ˆí•´ë˜ ë ìˆ˜ìˆê³ . í˜¹ì€ ë°”ì¸ë”© ì•ˆë˜ëŠ” ê²ƒë“¤ì€ ë¬´ì‹œí• ìˆ˜ë„ ìˆì§€ ì•Šë‚˜? -> ì´ê±° CMìª½ í”„ë¡œì íŠ¸ ë´ì•¼í• ë“¯
> ê°ì²´ì— Json ì„¸íŒ…í•˜ëŠ”ê±° ìˆì—ˆë˜ê±° ê°™ìŒ

- @RequestBody ëŠ” HttpMessageConverter ë‹¨ê³„ì—ì„œ JSON ë°ì´í„°ë¥¼ ê°ì²´ë¡œ ë³€ê²½í•˜ì§€ ëª»í•˜ë©´ ì´í›„ ë‹¨ê³„ ìì²´ê°€ ì§„í–‰ë˜ì§€ ì•Šê³  ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤.
  ì»¨íŠ¸ë¡¤ëŸ¬ë„ í˜¸ì¶œë˜ì§€ ì•Šê³ ,   Validatorë„ ì ìš©í•  ìˆ˜ ì—†ë‹¤.
  > ë””í…Œì¼ í•œ ë‚´ìš©ì€ pdfì— ì˜ ë‚˜ì˜´

## ì •ë¦¬


## ì‹¤ì œ ì‚¬ìš©

- bean validation ì¤‘ pattern
  - https://cheatsheetseries.owasp.org/cheatsheets/Bean_Validation_Cheat_Sheet.html#pattern