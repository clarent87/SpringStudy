# 로그인처리1 - 쿠키 세션

## 로그인 요구사항

## 프로젝트 생성 (4)

- 👍 패키지 구조 중요
  - 의존관계 단방향 중요
  - web 패키지랑 domain 패키지를 나눈이유가 나옴

## 홈 화면 (5)

## 회원 가입 (7)

## 로그인 기능 (13)

- 기본 로그인 기능 만듬

## 로그인 처리하기 - 쿠키 사용 (18)

- 쿠키
  - 영속 쿠키
  - 세션 쿠키  
    - http 세션, 서버 세션이랑 관련없다. 그냥 쿠키 종류임
    - > 브라우저 껏다 키면 제거됨. 아마 메모리에 올라간 값일듯?

- Cookie는 servlet에 있는거 씀
- @CookieValue 사용시 원래 쿠키값인 String을 param type에 맞게 변환해서 넣어줌. -> 이 원리는 나중에 소개
  - > 근데 mvc1에서도 비슷한 내용이 있었음. @RequstParam이 그랬던거 같은데.. String. Int 같은.. 맞나?

- 싱글페이지 애플리케이션의 경우 쿠키외에 다른 방식을 쓰기도 함
  - > 이거 react같은 형태 말하는듯? csr
- 물론 쿠키외에 다른 방식의 세션 유지 방식도 존재
  - 보통은 쿠키씀
  - > 서버에서 세션을 관리거나
  - > 클라이언트에서 쿠키를 관리하거나..
  - > 토큰.. 그거 있었지? JWT
  - <https://tecoble.techcourse.co.kr/post/2021-05-22-cookie-session-jwt/>
  
보안상 너무 큰 문제가 있다.

## 쿠키와 보안 문제 (25)

- ip가 중국에서 오거나 하면 쿠키를 제거해야함  
- 결국 요점은 서버 세션을 알려주려는 것
  - 쿠키는 랜덤값. 서버에서는 해당 값과 사용자 정보를 매칭해서 관리

## 로그인 처리하기 - 세션 동작 방식 (25)

- 쿠키는 UUID로 만드는게 좋다.
  - 중복될 일이 없음
- 세션 저장소를 루프를 돌아서 30분마다 사용이 안된 세션은 제거한다.
  - 해커가 탈취한 세션을 무한정 쓰지 못함
  - > 쿠키에도 사용 시간을 명시해서 쓸수 있는데, 이건 브라우저에게 먹히는 거인듯

pdf에 내용 잘나와 있음  
이렇게 개발 많이 한다고 함

## 로그인 처리하기 - 세션 직접 만들기 (28)

- test에서 MockHttpServletResponse 쓴거
- 세션id 만들떄 UUID 이용한거 

위 두개가 나름 인상 깊음

- ` sessionManager.createSession(loginMember, response);`
  - 원래 리팩토링 책에서 param으로 뭐 받아서 결과저장하는거 좋지 않다고 했었는데.
  - response는 원래 그런식으로 쓰니까 뉘앙스상 문제 없는듯?
  - > 근데 변수를 class의 field로 만들라는 건 어디 나온거였지? 그. 변수가 계속반복될때???

## 로그인 처리하기 - 직접 만든 세션 적용 (32)

- 만든거 적용이 전부 

## 로그인 처리하기 - 서블릿 HTTP 세션1 (34)

- 서블릿이 제공하는 세션 ID는 UUID는 아니네
- 상수만 저장해서 쓸 class는 interface나 abstract로 만들어서 객체 생성 안되게 하는게 좋음

```java
// 서블릿 세션은 request 객체에 존재
HttpSession session = request.getSession();
session.setAttribute(SessionConst.LOGIN_MEMBER, loginMember);
```

- 세션은 메모리를 쓰는거라서 꼭 필요할떄만 만들어야함. 
  - 세션을 생성하지 않고 읽기만 하려는 목적에서는 false를 줘야하는 이유임.
  - `request.getSession(false);`  true를 주면 세션이 없으면 자동 세션 생성 및 반환. false면 세션 생성은 안함. 없으면 null반환


- > 보니까 쿠키가 있으면 browser에서 쿠키는 자동으로 전달하는듯. 왜냐면 html에 쿠키 세팅하는 코드가 없음
- > TODO: redirect랑 forwarding 까먹음. RPG 다시 확인

## 로그인 처리하기 - 서블릿 HTTP 세션2 (38)

## 세션 정보와 타임아웃 설정

## 정리
