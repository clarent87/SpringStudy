# ë¡œê·¸ì¸ ì²˜ë¦¬2 - í•„í„°, ì¸í„°ì…‰í„°

## ì„œë¸”ë¦¿ í•„í„° - ì†Œê°œ

- í•„í„° : ì„œë¸”ë¦¿ ì œê³µ ê¸°ëŠ¥
- ì¸í„°ì…‰í„° : ìŠ¤í”„ë§ ì œê³µ ê¸°ëŠ¥
  
ìœ„ ë‘ê°œëŠ” ì¥ë‹¨ì´ ìˆì–´ì„œ, caseë§ˆë‹¤ ì„ íƒí•´ì„œ ì¨ì•¼ í•˜ë‚˜ë´„   

- ê³µí†µ ê´€ì‹¬ì‚¬
  - AOPë¡œ ì²˜ë¦¬ ë˜ì§€ë§Œ
  - ì›¹ì—ì„œëŠ” í•„í„°, ì¸í„°ì…‰í„° ì´ìš©í•˜ëŠ”ê²Œ ì¢‹ë‹¤. 
    - ì²˜ë¦¬ë¡œì§ì— url ë“±ë“±ì˜ ì •ë³´ê°€ í•„ìš”í•œë°, í•„í„°, ì¸í„°ì…‰í„°ê°€ HttpServletRequestë¥¼ ì œê³µí•´ì¤Œ

## ì„œë¸”ë¦¿ í•„í„° - ìš”ì²­ ë¡œê·¸ (3)

- HTTP ìš”ì²­ -> WAS -> í•„í„° -> ì„œë¸”ë¦¿ -> ì»¨íŠ¸ë¡¤ëŸ¬ -> í•„í„°
  - > í•„í„° í˜¸ì¶œ ìˆœì„œê°€ ìœ„ì™€ ê°™ë‹¤ê³  ë³´ì—¬ì§. pdfì—ì„œëŠ” "HTTP ìš”ì²­ -> WAS -> í•„í„° -> ì„œë¸”ë¦¿ -> ì»¨íŠ¸ë¡¤ëŸ¬" ê¹Œì§€ë§Œ ìˆìŒ  
  - > ì´ìœ ?  
  - > ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì—ëŸ¬ ë¡œê·¸ë¥¼ ë³´ë©´ í•„í„°REQUEST ë¡œê·¸-> errorlog -> í•„í„°RESPONSE ë¡œê·¸ ìˆœìœ¼ë¡œ ì°í˜  
  - > ìì„¸í•œê±´ codeì˜ logfilter ì°¸ì¡°

- UUIDë¡œ ê³ ê°ì˜ requestë¥¼ êµ¬ë¶„í–‡ëŠ”ë°. ì´ê±¸ transaction idë¼ê³ ë„ í•¨
- doFilterì—ì„œ ìš”ì²­ì´ ì²˜ë¦¬ë˜ëŠ” ì‹œê°„ ì²´í¬ë„ í• ìˆ˜ ìˆë‹¤. ì•„ë˜ ì²˜ëŸ¼

```java
        try {
            // ì‹œê°„ ì²´í¬ ì‹œì‘
            log.info("REQUEST [{}][{}]", uuid, requestURI);
            chain.doFilter(request, response);
        } catch (Exception e) {
            throw e;
        } finally {
            // ì‹œê°„ ì²´í¬ ì¢…ë£Œ í›„. ë¡œê·¸ ë‚¨ê¹€
            log.info("RESPONSE [{}][{}]", uuid, response);
        }
```

- ì£¼ì˜
  - í•„í„°ì—ì„œ chain.doFilter í˜¸ì¶œì•ˆí•´ì£¼ë©´ ë‹¤ìŒë‹¨ê³„ ì§„í–‰ì´ ì•ˆë¨.
  - ì¦‰, í•„í„° -> ì„œë¸”ë¦¿ -> ì»¨íŠ¸ë¡¤ëŸ¬ ì—ì„œ ì„œë¸”ë¦¿ ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œì—†ì´ ì¢…ë£Œë¨ ( ì‚¬ìš©ìëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì„¸íŒ…ëœ ì‘ë‹µì„ ë°›ì„ìˆ˜ê°€ ì—†ìŒ)

- ì°¸ê³ 
  - URL íŒ¨í„´ì— ëŒ€í•œ ë£°ì€ í•„í„°ë„ ì„œë¸”ë¦¿ê³¼ ë™ì¼í•˜ë‹¤. ìì„¸í•œ ë‚´ìš©ì€ ì„œë¸”ë¦¿ URL íŒ¨í„´ìœ¼ë¡œ ê²€ìƒ‰í•´ë³´ì.
- ì°¸ê³ 
  - @ServletComponentScan @WebFilter(filterName = "logFilter", urlPatterns = "/*") ë¡œ
  - í•„í„° ë“±ë¡ì´ ê°€ëŠ¥í•˜ì§€ë§Œ í•„í„° ìˆœì„œ ì¡°ì ˆì´ ì•ˆëœë‹¤. ë”°ë¼ì„œ FilterRegistrationBean ì„ ì‚¬ìš©í•˜ì.

- ì°¸ê³ 
  - ì‹¤ë¬´ì—ì„œ HTTP ìš”ì²­ì‹œ ê°™ì€ ìš”ì²­ì˜ ë¡œê·¸ì— ëª¨ë‘ ê°™ì€ ì‹ë³„ìë¥¼ ìë™ìœ¼ë¡œ ë‚¨ê¸°ëŠ” ë°©ë²•ì€ logback mdcë¡œ ê²€ìƒ‰í•´ë³´ì.
  - > í˜„ì¬ ì˜ˆì‹œì—ì„œëŠ” UUIDë¡œ filterì—ì„œ ì‚¬ìš©í•˜ê¸´ í•˜ëŠ”ë°. ì»¨íŠ¸ë¡¤ëŸ¬ì—ëŠ” í•´ë‹¹ ê°’ì´ ë„˜ì–´ê°€ì§€ ì•Šìœ¼ë‹ˆ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì°íˆëŠ” logëŠ” ìš”ì²­ êµ¬ë¶„ì´ ì•ˆë¨ 

## ì„œë¸”ë¦¿ í•„í„° - ì¸ì¦ ì²´í¬ (6)

- PatternMatchUtils 
  - > ì´ê±° ì¢‹ì€ë“¯. 
- interface default method ëŠ” êµ¬í˜„ì•ˆí•´ë„ ëœë‹¤. 
- í•„í„° í•œë‘ë²ˆ íƒ„ë‹¤ê³  í•´ì„œ ì„±ëŠ¥ì— ì´ìŠˆëŠ”ì—†ë‹¤. 
  - DB ì¡°íšŒë‚˜ ì™¸ë¶€ api í˜¸ì¶œ..ì´ëŸ°ë°ê°€ ì„±ëŠ¥ì— ì´ìŠˆì¸ ë¶€ë¶„. ë‚˜ë¨¸ì§€ëŠ” ëª¨ë˜ì•Œ ê°™ì€ ì˜í–¥ì„ ì¤€ë‹¤. 
- í•„í„° ìˆœì„œ
  - Log filter (request)-> loginCheck filter(ì—¬ê¸°ì„œ ì„œë¸”ë¦¿ -> ì»¨íŠ¸ë¡¤ëŸ¬ ê°”ë‹¤ì˜´.) -> log filter (response)
    - ìœ„ ìˆœìœ¼ë¡œ ë¡œê·¸ê°€ ì°í˜

ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ë„ ê²°êµ­ì„ filterì—ì„œ ì¶œë°œí•˜ëŠ”ê²ƒ ( filterë¥¼ ë“±ë¡í•˜ê³  ê·¸ëŸ°ê²Œ ê¸°ë³¸ì¸ê°€ë´„)  

- ì°¸ê³ 
  - í•„í„°ì—ëŠ” ë‹¤ìŒì— ì„¤ëª…í•  ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ì œê³µí•˜ì§€ ì•ŠëŠ”, ì•„ì£¼ ê°•ë ¥í•œ ê¸°ëŠ¥ì´ ìˆëŠ”ë°
  - chain.doFilter(request, response); ë¥¼ í˜¸ì¶œí•´ì„œ ë‹¤ìŒ í•„í„° ë˜ëŠ” ì„œë¸”ë¦¿ì„ í˜¸ì¶œí•  ë•Œ
  -  request ,response ë¥¼ ë‹¤ë¥¸ ê°ì²´ë¡œ ë°”ê¿€ ìˆ˜ ìˆë‹¤. ServletRequest , ServletResponse ë¥¼ êµ¬í˜„í•œ ë‹¤ë¥¸ ê°ì²´ë¥¼
  -  ë§Œë“¤ì–´ì„œ ë„˜ê¸°ë©´ í•´ë‹¹ ê°ì²´ê°€ ë‹¤ìŒ í•„í„° ë˜ëŠ” ì„œë¸”ë¦¿ì—ì„œ ì‚¬ìš©ëœë‹¤. ì˜ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ì€ ì•„ë‹ˆë‹ˆ ì°¸ê³ ë§Œ í•´ë‘ì.

## ìŠ¤í”„ë§ ì¸í„°ì…‰í„° - ì†Œê°œ (10)

- ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ê°€ ë”ì¢‹ìŒ. ë§ì€ ê¸°ëŠ¥ ì œê³µ
  - HandlerInterceptor
- ìŠ¤í”„ë§ ì¸í„°ì…‰í„° íë¦„
  - HTTP ìš”ì²­ -> WAS -> í•„í„° -> ì„œë¸”ë¦¿(ë””ìŠ¤íŒ¨ì³ ì„œë¸”ë¦¿) -> ìŠ¤í”„ë§ ì¸í„°ì…‰í„° -> ì»¨íŠ¸ë¡¤ëŸ¬
    - > ë³´ë©´ ì„œë¸”ë¦¿ í•„í„°ê°€ ë¨¼ì € ì²˜ë¦¬ë˜ê³ , ë””ìŠ¤íŒ¨ì³ ì„œë¸”ë¦¿ì—ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ ì‚¬ì´ì—ì„œ ì¸í„°ì…‰í„°ê°€ ë™ì‘

- í•„í„°ì˜ ê²½ìš° ë‹¤ìŒìœ¼ë¡œ ë“¤ì–´ê°€ë ¤ë©´  `chain.doFilter` í˜¸ì¶œí•´ì•¼ í•˜ëŠ”ë°, ì´ê±° ì‹¤ìˆ˜ë¡œ í˜¸ì¶œ ì•ˆí•˜ëŠ” ê²½ìš° ë§ë‹¤ê³  í•¨

- ì¸í„°ì…‰í„°ì˜ ê²½ìš° preHandle, postHandle, afterCompletion ì„ ì œê³µ
  - ì´ê±° í˜¸ì¶œ ë˜ëŠ” ìœ„ì¹˜, íƒ€ì´ë°ì€ pdfì— ê·¸ë¦¼ìœ¼ë¡œ ì•„ì£¼ ì˜ ë‚˜ì™€ ìˆìŒ ğŸ‘

- postHandle vs afterCompletion
  - pdfì— ì˜ë‚˜ì˜´. 
  - ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì˜ˆì™¸ê°€ í„°ì§€ë©´ postHandleì€ í˜¸ì¶œë˜ì§€ ì•ŠìŒ. afterCompletionì€ í˜¸ì¶œë¨
  - > ì„œë¹„ìŠ¤ ê°œë°œí• ë–„ controllerì—ì„œëŠ” ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ì§€ ì•Šê³  ëª¨ë‘ ì—¬ê¸°ë¡œ ë‚ ë¦¬ëŠ”ê±° ì–´ë–°?
  - > ê·¸ëŸ¬ë©´ http ìƒíƒœ ì²˜ë¦¬ í• ë ¤ê³  returnì€ ResponseEntity í•  í•„ìš”ë„ ì—†ìŒ

- ì •ë¦¬
  - ì¸í„°ì…‰í„°ëŠ” ìŠ¤í”„ë§ MVC êµ¬ì¡°ì— íŠ¹í™”ëœ í•„í„° ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤ê³  ì´í•´í•˜ë©´ ëœë‹¤. ìŠ¤í”„ë§ MVCë¥¼ ì‚¬ìš©í•˜ê³ ,
  - íŠ¹ë³„íˆ í•„í„°ë¥¼ ê¼­ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ ì•„ë‹ˆë¼ë©´ **ì¸í„°ì…‰í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” í¸ë¦¬í•˜ë‹¤**

## ìŠ¤í”„ë§ ì¸í„°ì…‰í„° - ìš”ì²­ ë¡œê·¸ (14)

- > LogInterceptor, ì„œë¸”ë¦¿ í•„í„° ëª¨ë‘ ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬ë˜ëŠ”ë“¯

- @RequestMappingì„ ì“°ë©´ ì„ íƒë˜ëŠ” í•¸ë“¤ëŸ¬ëŠ” -> HandlerMethod
  - > mvc1ì— ë‚´ìš©ì´ë¬ëŠ”ë°. ì—†ëŠ”ê±° ê°™ì€ë°...........
  - https://mangkyu.tistory.com/180 
    - ì´ê±° í›¨ì”¬ ì í™•í•¨ ğŸ‘ğŸ‘ğŸ‘

- > ~~HandlerMethodê°€ ê°•ì¢Œì—ì„œëŠ” í•¸ë“¤ëŸ¬ë¡œ ì†Œê°œê°€ ë˜ëŠ”ê±° ê°™ì€ë°. ì˜ëª»ëœ ë‚´ìš© ê°™ìŒ~~ -> ì•„ë‹˜ ë‚´ê°€ ì˜ëª» ì´í•´í•¨
  - ì•„ë‹˜. ë§ëŠ”ê±° ê°™ìŒ. 
  - ìƒê°í•´ë³´ë©´ ì›ë˜ mvc ì´ˆê¸°ì—ì„œëŠ” classí•˜ë‚˜ê°€ í•¸ë“¤ëŸ¬ ì˜€ìŒ. ê·¼ë° @ControllerëŠ” í•˜ë‚˜ì˜ classì— ì—¬ëŸ¬ methodë¥¼ ë‘˜ìˆ˜ ìˆì—ˆê³ .
  - ì˜ë¯¸ìƒ ì´ methodë“¤ì´ ê°ê° í•˜ë‚˜ì˜ í•¸ë“¤ëŸ¬ì¸ê°€ë´„.
  - ê²°êµ­ ì»¨íŠ¸ë¡¤ëŸ¬ == í•¸ë“¤ëŸ¬ ì˜ë¯¸ëŠ” mvc ì²˜ìŒ class ë§Œë“¤ë–„ classì— methodí•˜ë‚˜ì‹ ë§¤ì¹˜ ì‹œì¼°ë˜ ê·¸ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì˜ë¯¸í•˜ëŠ”ê±° ê°™ìŒ
    - @Controller ë§ê³ ..
  - >  ë‚´ê°€ ì˜¤í•´í•˜ê³  ìˆë˜ê²Œ @Controllerê°€ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì•„ë‹˜. 
  - > mvc1ì˜ ì´ˆë°˜ì— classë‹¹ í•˜ë‚˜ì˜ urië¥¼ ì²˜ë¦¬í•˜ë˜ ê·¸ê±°,ì¦‰ íŠ¹ì • urië¥¼ ì²˜ë¦¬í•˜ëŠ” ë…€ì„ì´ ì»¨íŠ¸ë¡¤ëŸ¬ == í•¸ë“¤ëŸ¬ì„.

- ResourceHttpRequestHandler
  - @Controller ê°€ ì•„ë‹ˆë¼ /resources/static ì™€ ê°™ì€ ì •ì  ë¦¬ì†ŒìŠ¤ê°€ í˜¸ì¶œ ë˜ëŠ” ê²½ìš°
  - ResourceHttpRequestHandler ê°€ í•¸ë“¤ëŸ¬ ì •ë³´ë¡œ ë„˜ì–´ì˜¤ê¸° ë•Œë¬¸ì— íƒ€ì…ì— ë”°ë¼ì„œ ì²˜ë¦¬ê°€ í•„ìš”í•˜ë‹¤
  - > preHandleë¡œ ë„˜ì–´ì˜¤ëŠ” handlerê°€ ResourceHttpRequestHandler / HandlerMethod ë“±ì´ ì˜¤ë‚˜ë´„

- ì •ë¦¬
  - HandlerInterceptor ë¥¼ êµ¬í˜„í•œê²ƒ. 
  - preHandlerë§Œ returnì´ boolì´ê³  ë‚˜ë¨¸ì§€ëŠ” void
    - return falseë©´ ë”ì´ìƒ ì§„í–‰ì•ˆë¨. trueë©´ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ë„˜ì–´ê°

## ìŠ¤í”„ë§ ì¸í„°ì…‰í„° - ì¸ì¦ ì²´í¬ (18)

- ì¸ì¦ ì²´í¬ê°œë°œ filterë³´ë‹¤ í›¨ì”¬ ë‚˜ìŒ. ì™œëƒë©´ uri ì²˜ë¦¬ë¥¼ ì¸í„°ì…‰í„° ë“±ë¡ì‹œ ì²˜ë¦¬ ê°€ëŠ¥

## ArgumentResolver í™œìš© (20)

> í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ì—ì„œ í•¸ë“¤ëŸ¬ í˜¸ì¶œì „ì— ë“¤ì–´ê°€ëŠ”ê²Œ ArgumentResolver.. ì—¬ê¸°ì„œ httpMessageConverter í˜¸ì¶œë˜ëŠ”ê±° ì˜€ìŒ
  
- ì–´ë…¸í…Œì´ì…˜ ë§Œë“¤ê¸°
  - Target, Retention í•„ìˆ˜

- @SessionAttributeëŒ€ì‹  @Loginì„ ë§Œë“¤ê³ , argumentResolverì—ì„œ í•´ë‹¹ annotationì´ ìˆëŠ”ì§€ í™•ì¸í›„, member ë¥¼ ë§Œë“¤ì–´ì„œ ë„˜ê¹€
  - > ê·¼ë° argumentResolverì—ì„œ ì—ëŸ¬ ë‚˜ë©´ ì–´ì°Œë¨??? bindResult?? ë‘ì€ ê´€ë ¨ ì—†ì„ê¹Œ?


## ì •ë¦¬
