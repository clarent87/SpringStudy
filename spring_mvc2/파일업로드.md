# 파일 업로드

## 파일 업로드 소개

- `multipart/form-data`에 대한 소개
  - multi part라는 말은 part가 여러개라는것
  - 즉 request에 문자 이미지등 여러 type의 data를 전달할 수 있음
  - 이떄 boundary 문자열은 랜덤하게 생성된다함. 

- html form에서는
  - `enctype="multipart/form-data"` 를 써야 request로 mutipart가 날아간다. 

## 프로젝트 생성

## 서블릿과 파일업로드 1 (5)

여기서는 form에서 multipart로 전송해서 컨트롤러에서 어떻게 받는지를 소개함. 
  
- `logging.level.org.apache.coyote.http11=debug`
  - 이거 쓰면 http 요청 메시지를 서버에서 다 볼수가 있다.

- `spring.servlet.multipart.enabled=false`
  - 크게 중요하진 않음
  - 이거 하면 multipart에 대한 처리를 spring이 해주지 않는다. 
  - 그래서 Request객체는 기존 처럼 RequestFacade로 오고,
  - getParam으로 text data를 읽지도 못함.
    - > 멀티파트 처리를 해준경우는 getParam으로 text data를 읽을수 있음

- 특이점
  - multipart로 form data를 보냈는데, getParam으로 itemName 잘 받아짐

- 옵션
  - properties로 저장할 파일 size 제한 등등 할수 잇음

- Tip
  - dispatcherServlet class에서 doDispatch 볼수 있다. 
  - > 여기서 webAsyncManager가 보임
  - 그리고 MultipartResolver 도 여기서 호출됨. checkMultiPart라는 method가 보임. 그안에 호출 구문 있음
    - 여기서 request를 MultipartHttpServletRequest 로 변환해서 반환. 그래서 컨트롤러에서는 이것을 주입 받음 (request로..)
    - 그래서 컨트롤러에서 MultipartHttpServletRequest를 받아서 쓸순 있는데. 뒤에서 나올 MultipartFile가 더 편해서 안씀.

## 서블릿과 파일업로드 2 (10)

- spring core에 StringUtils 랑 StreamUtils 같은 편리한 util 있네

## 스프링과 파일 업로드 (14)

- `@RequestParam MultipartFile file`
  - 스프링 쓰면 이거 한줄로 끝남. multipart에서 file type 받은 부분만 떼어내서 이렇게 받을수 있음
  - 멀티파트에서 text 타입인 part도 그냥 `@RequestParam String itemName` 로 받으면됨

- MultipartFile
  - 위 class의 method에 여러 기능들이 있음

- 추가로 @ModelAttribute 에서도 MultipartFile 을 동일하게 사용할 수 있다
  - > 이거 무슨 의미 인지?? 잘 이해 안감. 
  - > 객체안에 MultipartFile type으로 변수 두고 변수 이름은 form의 input 이름과 맞추면 된다는거 같은 느낌.

- 기타 
  - file upload 관련 보안
    - https://www.opswat.com/blog/file-upload-protection-best-practices

## 예제로 구현하는 파일 업로드, 다운로드

## 정리